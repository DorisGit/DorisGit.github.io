<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://dorisgit.github.io').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="检测启动时间冷启动和热启动 冷启动：指 App被后台Kill后重新启动 热启动：App的状态由running切换至suspend，App没有被kill仍然在后台运行，再次将App切换至前台  启动时间启动时间划分可以把main()函数作为关键点分割成两块  t1阶段，main()函数之前，成为pre-main t2阶段，main()函数及main()函数之后之后处理所需时间   t1阶段：pre-">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS-启动优化">
<meta property="og:url" content="https://dorisgit.github.io/2020/12/28/iOS-%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="泡泡茶壶">
<meta property="og:description" content="检测启动时间冷启动和热启动 冷启动：指 App被后台Kill后重新启动 热启动：App的状态由running切换至suspend，App没有被kill仍然在后台运行，再次将App切换至前台  启动时间启动时间划分可以把main()函数作为关键点分割成两块  t1阶段，main()函数之前，成为pre-main t2阶段，main()函数及main()函数之后之后处理所需时间   t1阶段：pre-">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/1723a78c376791a7.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/1723a70f03e23995.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228143351368.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/1723b443939cb86a.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/1723b49489c7e84b.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/1723b9a250ed488e.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/1723b98983c1778f.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228172047101.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228184414293.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228192825215.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228193020738.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228193341997.png">
<meta property="og:image" content="http://qn49kho58.bkt.gdipper.com/image-20201228193941872.png">
<meta property="article:published_time" content="2020-12-28T06:19:54.000Z">
<meta property="article:modified_time" content="2021-01-25T06:40:47.244Z">
<meta property="article:author" content="Doris AI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qn49kho58.bkt.gdipper.com/1723a78c376791a7.png">

<link rel="canonical" href="https://dorisgit.github.io/2020/12/28/iOS-%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>iOS-启动优化 | 泡泡茶壶</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泡泡茶壶</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://dorisgit.github.io/2020/12/28/iOS-%E5%90%AF%E5%8A%A8%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Doris AI">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泡泡茶壶">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOS-启动优化
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-28 14:19:54" itemprop="dateCreated datePublished" datetime="2020-12-28T14:19:54+08:00">2020-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-25 14:40:47" itemprop="dateModified" datetime="2021-01-25T14:40:47+08:00">2021-01-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="检测启动时间"><a href="#检测启动时间" class="headerlink" title="检测启动时间"></a>检测启动时间</h2><h3 id="冷启动和热启动"><a href="#冷启动和热启动" class="headerlink" title="冷启动和热启动"></a>冷启动和热启动</h3><ul>
<li>冷启动：指 <code>App</code>被后台Kill后重新启动</li>
<li>热启动：<code>App</code>的状态由<code>running</code>切换至<code>suspend</code>，<code>App</code>没有被<code>kill</code>仍然在后台运行，再次将<code>App</code>切换至前台</li>
</ul>
<h3 id="启动时间"><a href="#启动时间" class="headerlink" title="启动时间"></a>启动时间</h3><p>启动时间划分可以把<code>main()</code>函数作为关键点分割成两块</p>
<ul>
<li><code>t1</code>阶段，<code>main()</code>函数之前，成为<code>pre-main</code></li>
<li><code>t2</code>阶段，<code>main()</code>函数及<code>main()</code>函数之后之后处理所需时间</li>
</ul>
<p><img src="http://qn49kho58.bkt.gdipper.com/1723a78c376791a7.png" alt="1723a78c376791a7"></p>
<h4 id="t1阶段：pre-main"><a href="#t1阶段：pre-main" class="headerlink" title="t1阶段：pre-main"></a>t1阶段：<code>pre-main</code></h4><p><img src="http://qn49kho58.bkt.gdipper.com/1723a70f03e23995.png" alt="1723a70f03e23995"></p>
<h4 id="t2阶段"><a href="#t2阶段" class="headerlink" title="t2阶段"></a>t2阶段</h4><p>t2阶段的耗时主要在业务代码，根据打点统计业务耗时</p>
<h3 id="Xcode测量-pre-main-时间"><a href="#Xcode测量-pre-main-时间" class="headerlink" title="Xcode测量 pre-main 时间"></a>Xcode测量 pre-main 时间</h3><p>通过添加环境变量可以获取到 pre-main阶段的时间。</p>
<h4 id="DYLD-PRINT-STATISTICS"><a href="#DYLD-PRINT-STATISTICS" class="headerlink" title="DYLD_PRINT_STATISTICS"></a><code>DYLD_PRINT_STATISTICS</code></h4><p>Xcode中提供了测量pre-main的时间，Edit scheme -&gt; Run -&gt;Augments添加环境变量DYLD_PRINT_STATISTICS，value为YES</p>
<p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228143351368.png" alt="image-20201228143351368"></p>
<p>启动后可以看到启动时长</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Total pre-main time: 2.4 seconds (100.0%)</span><br><span class="line">         dylib loading time: 1.0 seconds (43.9%)</span><br><span class="line">        rebase&#x2F;binding time: 386.35 milliseconds (15.6%)</span><br><span class="line">            ObjC setup time: 199.85 milliseconds (8.0%)</span><br><span class="line">           initializer time: 798.44 milliseconds (32.3%)</span><br><span class="line">           slowest intializers :</span><br><span class="line">             libSystem.B.dylib :   9.73 milliseconds (0.3%)</span><br><span class="line">          libglInterpose.dylib : 504.02 milliseconds (20.3%)</span><br><span class="line">                  AFNetworking :  50.88 milliseconds (2.0%)</span><br><span class="line">                           xxx : 195.11 milliseconds (7.8%)</span><br></pre></td></tr></table></figure>

<h4 id="加载dylib"><a href="#加载dylib" class="headerlink" title="加载dylib"></a>加载dylib</h4><p>分析每个dylib动态链接库，找到其Mach-O文件，打开并读取验证有效性；找到代码签名注册到内核，最后对dylib的每个segment调用mmap()</p>
<p>在dylib的加载过程中为了安全考虑加载ASLR（Address Space Layout Randomization）技术和代码签名</p>
<p>ASLR技术：镜像Image、可执行文件、dylib、bundle在加载的时候会再起指向的地址(preferred_address)前面添加一个随机数偏差(slide)，防止应用内部地址被定位。</p>
<h4 id="Rebase-Bind"><a href="#Rebase-Bind" class="headerlink" title="Rebase/Bind"></a>Rebase/Bind</h4><ul>
<li>dylib加载完成之后，它们处于互相独立的状态，需要绑定起来</li>
<li>Rebase将镜像读入内存，修正镜像内部的指针，性能消耗主要在IO</li>
<li>Bind是查询符号表，设置指向镜像外部的指针，性能消耗主要在CPU计算</li>
</ul>
<h4 id="Objc-setup"><a href="#Objc-setup" class="headerlink" title="Objc setup"></a>Objc setup</h4><p>runtime会维护一张类名与类的方法列表的全局表</p>
<ul>
<li>读取所有类，将类对象其注册到这个全局表中（class registration）</li>
<li>读取所有分类，把分类加载到类对象中（category registration）</li>
<li>检查selector的唯一性（selector uniquing）</li>
</ul>
<h4 id="Initializer-time"><a href="#Initializer-time" class="headerlink" title="Initializer time"></a>Initializer time</h4><p>这部分主要就是load方法的耗时</p>
<h4 id="DYLD-PRINT-STATISTICS-DETAILS"><a href="#DYLD-PRINT-STATISTICS-DETAILS" class="headerlink" title="DYLD_PRINT_STATISTICS_DETAILS"></a><code>DYLD_PRINT_STATISTICS_DETAILS</code></h4><p>为了获取更详细的时间信息，添加环境变量<code>DYLD_PRINT_STATISTICS_DETAILS</code>，value为YES</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">  total time: 3.7 seconds (100.0%)</span><br><span class="line">  total images loaded:  735 (658 from dyld shared cache)</span><br><span class="line">  total segments mapped: 306, into 102134 pages</span><br><span class="line">  total images loading time: 2.5 seconds (66.8%)</span><br><span class="line">  total load time in ObjC: 198.07 milliseconds (5.2%)</span><br><span class="line">  total debugger pause time: 1.3 seconds (35.7%)</span><br><span class="line">  total dtrace DOF registration time:   0.00 milliseconds (0.0%)</span><br><span class="line">  total rebase fixups:  1,121,422</span><br><span class="line">  total rebase fixups time: 103.90 milliseconds (2.7%)</span><br><span class="line">  total binding fixups: 86,509</span><br><span class="line">  total binding fixups time: 187.76 milliseconds (4.9%)</span><br><span class="line">  total weak binding fixups time:  18.64 milliseconds (0.4%)</span><br><span class="line">  total redo shared cached bindings time:  30.19 milliseconds (0.7%)</span><br><span class="line">  total bindings lazily fixed up: 0 of 0</span><br><span class="line">  total time in initializers and ObjC +load: 749.00 milliseconds (19.7%)</span><br><span class="line">                         libSystem.B.dylib :   7.93 milliseconds (0.2%)</span><br><span class="line">               libBacktraceRecording.dylib :   7.26 milliseconds (0.1%)</span><br><span class="line">                           libobjc.A.dylib :  11.82 milliseconds (0.3%)</span><br><span class="line">                      libglInterpose.dylib : 464.63 milliseconds (12.2%)</span><br><span class="line">                       libMTLCapture.dylib :  17.50 milliseconds (0.4%)</span><br><span class="line">                              AFNetworking :  50.53 milliseconds (1.3%)</span><br><span class="line">                                 Alamofire :   5.91 milliseconds (0.1%)</span><br><span class="line">                               DoraemonKit :   4.43 milliseconds (0.1%)</span><br><span class="line">                                    NIMSDK :   4.47 milliseconds (0.1%)</span><br><span class="line">                                       NMC :  10.72 milliseconds (0.2%)</span><br><span class="line">                       PLMediaStreamingKit :   5.44 milliseconds (0.1%)</span><br><span class="line">                                   iAdCore :   4.12 milliseconds (0.1%)</span><br><span class="line">                                   		 xxx : 171.85 milliseconds (4.5%)</span><br><span class="line">total symbol trie searches:    184588</span><br><span class="line">total symbol table binary searches:    0</span><br><span class="line">total images defining weak symbols:  80</span><br><span class="line">total images using weak symbols:  173</span><br></pre></td></tr></table></figure>

<h2 id="物理内存和虚拟内存"><a href="#物理内存和虚拟内存" class="headerlink" title="物理内存和虚拟内存"></a>物理内存和虚拟内存</h2><h3 id="内存浪费"><a href="#内存浪费" class="headerlink" title="内存浪费"></a>内存浪费</h3><p>早期计算机需要不断启动应用，到达一定数量以后就会报错，应用无法正常运行，必须先关闭前面的部分应用才能继续开启。</p>
<p>这是因为早期计算机没有虚拟地址，一旦加载都会全部加载到内存中，一但物理内存不够了，那么应用就无法继续开启。</p>
<p>应用在内存中的排序都是顺序排列的，这样进程只需要将自己的地址尾部往右偏移一点就能访问到别的进程中的内存地址，想当不安全。</p>
<p><img src="http://qn49kho58.bkt.gdipper.com/1723b443939cb86a.png" alt="1723b443939cb86a"></p>
<h3 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h3><p>用户使用时并不会使用到全部内存，如果App一启动就全部加载到内存中会浪费很多内存空间，<strong>虚拟内存技术</strong>的出现就是为了解决这个内存浪费情况。</p>
<p>App启动后会认为自己已经获取到了整个App运行所需的内存空间，但实际上并没有在物理内存上为他申请那么大的空间，只是生产了一张 <strong>虚拟内存和物理内存关联的表</strong>。</p>
<p><img src="http://qn49kho58.bkt.gdipper.com/1723b49489c7e84b.png" alt="1723b49489c7e84b"></p>
<h3 id="地址翻译"><a href="#地址翻译" class="headerlink" title="地址翻译"></a>地址翻译</h3><p>当App需要使用某一块虚拟内存的地址时，会通过这张表查询该虚拟地址是否已经在物理内存中申请了空间。</p>
<ul>
<li>如果已经申请就通过表的记录访问物理内存地址</li>
<li>如果没有申请则申请一块物理内存空间并记录在表中（Page Fault）</li>
</ul>
<p>这个通过进程映射表映射到不同的物理内存空间的操作叫做地址翻译，这个过程需要CPU和操作系统配合。</p>
<h4 id="Page-Fault"><a href="#Page-Fault" class="headerlink" title="Page Fault"></a>Page Fault</h4><p>当数据未在物理内存会进行下列操作</p>
<ul>
<li>系统阻塞该进程</li>
<li>将磁盘中对应page的数据加载到内存</li>
<li>将虚拟内存指向物理内存</li>
</ul>
<h4 id="灵活内存管理"><a href="#灵活内存管理" class="headerlink" title="灵活内存管理"></a>灵活内存管理</h4><p>虽然解决了浪费问题，但是一旦出现物理内存空间全被申请的情况，还是有可能会产生内存不足的情况，为保证当前App的政策适用，数据加载遵循以下原则：</p>
<ul>
<li>如果有空闲内存空间就放空的内存空间中</li>
<li>如果没有就覆盖其他进程的数据</li>
<li>具体覆盖由操作系统处理</li>
</ul>
<h3 id="解决安全问题"><a href="#解决安全问题" class="headerlink" title="解决安全问题"></a>解决安全问题</h3><p>空间问题已经解决了，但是安全问题呢？</p>
<p>在dylib加载过程中系统为了安全考虑引入了ASLR（Address Space Layout Randomization）技术和代码签名</p>
<p>ASLR技术：镜像Image、可执行文件、dylib、bundle在加载的时候会在其指向的地址（preferred_address）前面添加一个随机数偏差（slide），防止应用内部地址被定位</p>
<h2 id="二进制重排"><a href="#二进制重排" class="headerlink" title="二进制重排"></a>二进制重排</h2><h3 id="为什么进行二进制重排"><a href="#为什么进行二进制重排" class="headerlink" title="为什么进行二进制重排"></a>为什么进行二进制重排</h3><p>虚拟内存技术会产生缺页中断（Page Fault），这个过程是个耗时操作。</p>
<p>每页耗时也会有很大差距，1微妙到0.8毫秒不等。</p>
<p>使用过程中对这点耗时感觉不明显，但是启动时加载大量数据，如果产生大量缺页中断（Page Fault）从而优化启动速度，这就是二进制重排。</p>
<h3 id="重排目的"><a href="#重排目的" class="headerlink" title="重排目的"></a>重排目的</h3><p>二进制重排就是为了减少启动时的缺页异常（Page Fault）从而减少启动时间</p>
<p><img src="http://qn49kho58.bkt.gdipper.com/1723b9a250ed488e.png" alt="1723b9a250ed488e"></p>
<p><img src="http://qn49kho58.bkt.gdipper.com/1723b98983c1778f.png" alt="1723b98983c1778f"></p>
<h3 id="查看Page-Fault"><a href="#查看Page-Fault" class="headerlink" title="查看Page Fault"></a>查看Page Fault</h3><p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228172047101.png" alt="image-20201228172047101"></p>
<p>Page Fault会随着代码和文件的增加而增加，而二进制重排可以很好优化这个问题，其中心思想是重新排列方法符号的顺序，使启动的相关方法，排在最前面从而减少启动Page Fault。</p>
<h3 id="Link-Map-File"><a href="#Link-Map-File" class="headerlink" title="Link Map File"></a>Link Map File</h3><h4 id="什么是Link-Map-File文件？"><a href="#什么是Link-Map-File文件？" class="headerlink" title="什么是Link Map File文件？"></a>什么是Link Map File文件？</h4><p><code>Link Map File</code>直译为链接映射文件，是Xcode生成可执行文件时一起生成的文本，用于记录链接相关信息。</p>
<ul>
<li>可执行文件路径</li>
<li>CPU架构</li>
<li>.o目标路径</li>
<li>方法符号</li>
</ul>
<h4 id="Link-Map-File文件作用"><a href="#Link-Map-File文件作用" class="headerlink" title="Link Map File文件作用"></a>Link Map File文件作用</h4><ul>
<li>查看代码加载顺序</li>
<li>理解内存分段分区</li>
<li><code>Crash</code>时通过<code>Symbols</code>定位源码的机制</li>
<li>分析可执行文件中类和库体积，优化包体积</li>
</ul>
<h4 id="生成Link-Map-File"><a href="#生成Link-Map-File" class="headerlink" title="生成Link Map File"></a>生成Link Map File</h4><p><code>Xcode</code> 在生成可执行文件的时候默认情况下不生成该文件。</p>
<p>在<code>Xcode</code>的配置中 <code>Target -&gt; Build Setting -&gt; Linking</code> 将<code>Write Link Map File</code>设置为<code>YES</code>来生成<code>Link Map File</code>，运行代码即可生成<code>Link Map File</code></p>
<p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228184414293.png" alt="image-20201228184414293"></p>
<h4 id="查看Link-Map-File文件"><a href="#查看Link-Map-File文件" class="headerlink" title="查看Link Map File文件"></a>查看Link Map File文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;Users&#x2F;mikasa&#x2F;Library&#x2F;Developer&#x2F;Xcode&#x2F;DerivedData&#x2F;xxx-esvlirvezjzdpuataqpznpbhress&#x2F;Build&#x2F;Intermediates.noindex&#x2F;xxx.build&#x2F;Debug-iphoneos&#x2F;xxx.build&#x2F;xxx-LinkMap-normal-arm64.txt</span><br></pre></td></tr></table></figure>

<p><code>Link Map File</code>主要分为3部分</p>
<ul>
<li>路径部分，展示生成的相关文件路径</li>
<li><code>Section</code>部分，展示相关地址段</li>
<li><code>Sybols</code>部分，方法符号段</li>
</ul>
<h5 id="路径部分"><a href="#路径部分" class="headerlink" title="路径部分"></a>路径部分</h5><ul>
<li><code>Path</code>是<code>.app</code>文件路径</li>
<li><code>Object files</code>是<code>.0</code>文件路径</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Path: /Users/mikasa/Library/Developer/Xcode/DerivedData/xxx-esvlirvezjzdpuataqpznpbhress/Build/Products/Debug-iphoneos/xxx.app/xxx</span><br><span class="line"># Arch: arm64</span><br><span class="line"># Object files:</span><br><span class="line">[  <span class="number">0</span>] linker synthesized</span><br><span class="line">[  <span class="number">1</span>] /Users/mikasa/Library/Developer/Xcode/DerivedData/xxx-esvlirvezjzdpuataqpznpbhress/Build/Intermediates.noindex/xxx.build/Debug-iphoneos/xxx.build/Objects-normal/arm64/<span class="built_in">UIView</span>+Transform.o</span><br><span class="line">[  <span class="number">2</span>] /Users/mikasa/Library/Developer/Xcode/DerivedData/xxx-esvlirvezjzdpuataqpznpbhress/Build/Intermediates.noindex/xxx.build/Debug-iphoneos/xxx.build/Objects-normal/arm64/GMCardViewModel.o</span><br><span class="line">[  <span class="number">3</span>] /Users/mikasa/Library/Developer/Xcode/DerivedData/xxx-esvlirvezjzdpuataqpznpbhress/Build/Intermediates.noindex/xxx.build/Debug-iphoneos/xxx.build/Objects-normal/arm64/GMTagSelectChoosedTagsView.o</span><br><span class="line">[  <span class="number">4</span>] /Users/mikasa/Library/Developer/Xcode/DerivedData/xxx-esvlirvezjzdpuataqpznpbhress/Build/Intermediates.noindex/xxx.build/Debug-iphoneos/xxx.build/Objects-normal/arm64/GMPaymentSuccessCell.o</span><br><span class="line">[  <span class="number">5</span>] /Users/mikasa/Library/Developer/Xcode/DerivedData/xxx-esvlirvezjzdpuataqpznpbhress/Build/Intermediates.noindex/xxx.build/Debug-iphoneos/xxx.build/Objects-normal/arm64/GMAreaCodeObject.o</span><br></pre></td></tr></table></figure>

<h5 id="Section部分"><a href="#Section部分" class="headerlink" title="Section部分"></a>Section部分</h5><p><code>Mach-O</code>文件中的虚拟地址最终会映射到物理地址上，这些地址被分为不同的Segment：<code>__TEXT段</code>、<code>__DATA</code>段、<code>__LINKEDIT</code>段</p>
<ul>
<li><code>__TEXT</code>包含<code>Mach Header</code>，被执行的代码和只读常量（如<code>C</code>字符串），只读可执行（<code>r-x</code>）</li>
<li><code>__DATA</code>包含全局变量，静态变量，可读写（<code>rw-</code>）</li>
<li><code>__LINKEDIT</code>包含了加载程序的元数据，比如函数的名称和地址，只读(<code>r-</code>)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># Sections:</span><br><span class="line"># Address	Size    	Segment	Section</span><br><span class="line">0x100007CCC	0x02A93384	__TEXT	__text				&#x2F;&#x2F; 代码节，存放机器编译后的代码</span><br><span class="line">0x102A9B050	0x00006264	__TEXT	__stubs				&#x2F;&#x2F; 用于辅助做动态链接代码（dyld）</span><br><span class="line">0x102AA12B4	0x00006108	__TEXT	__stub_helper</span><br><span class="line">0x102AA73BC	0x000F2D75	__TEXT	__objc_methname</span><br><span class="line">0x102B9A131	0x0001BC91	__TEXT	__objc_classname</span><br><span class="line">0x102BB5DC2	0x000267BF	__TEXT	__objc_methtype</span><br><span class="line">0x102BDC584	0x000E2EBC	__TEXT	__gcc_except_tab</span><br><span class="line">0x102CBF440	0x0025DEFF	__TEXT	__cstring</span><br><span class="line">0x102F1D340	0x0000FD74	__TEXT	__ustring</span><br><span class="line">0x102F2D0C0	0x0011BF32	__TEXT	__const</span><br><span class="line">0x103048FF2	0x00004A64	__TEXT	__swift5_typeref</span><br><span class="line">0x10304DA58	0x0000840C	__TEXT	__swift5_fieldmd</span><br><span class="line">0x103055E64	0x00000A08	__TEXT	__swift5_types</span><br><span class="line">0x10305686C	0x000000A0	__TEXT	__swift5_protos</span><br><span class="line">0x103056910	0x00007992	__TEXT	__swift5_reflstr</span><br><span class="line">0x10305E2A4	0x00000424	__TEXT	__swift5_builtin</span><br><span class="line">0x10305E6C8	0x00000A38	__TEXT	__swift5_assocty</span><br><span class="line">0x10305F100	0x000007CC	__TEXT	__swift5_proto</span><br><span class="line">0x10305F8CC	0x000028E4	__TEXT	__swift5_capture</span><br><span class="line">0x1030621B0	0x00080BC8	__TEXT	__unwind_info</span><br><span class="line">0x1030E2D78	0x0000D284	__TEXT	__eh_frame</span><br><span class="line">0x1030F0000	0x00002E18	__DATA	__got</span><br><span class="line">0x1030F2E18	0x00004198	__DATA	__la_symbol_ptr</span><br><span class="line">0x1030F6FB0	0x00000750	__DATA	__mod_init_func</span><br><span class="line">0x1030F7700	0x000A0FB0	__DATA	__const</span><br><span class="line">0x1031986B0	0x000913E0	__DATA	__cfstring</span><br><span class="line">0x103229A90	0x00009018	__DATA	__objc_classlist</span><br><span class="line">0x103232AA8	0x00000058	__DATA	__objc_nlclslist</span><br><span class="line">0x103232B00	0x00000A08	__DATA	__objc_catlist</span><br><span class="line">0x103233508	0x00000048	__DATA	__objc_nlcatlist</span><br><span class="line">0x103233550	0x000015A0	__DATA	__objc_protolist</span><br><span class="line">0x103234AF0	0x00000008	__DATA	__objc_imageinfo</span><br><span class="line">0x103234AF8	0x00501000	__DATA	__objc_const</span><br><span class="line">0x103735AF8	0x0003A320	__DATA	__objc_selrefs</span><br><span class="line">0x10376FE18	0x00000498	__DATA	__objc_protorefs</span><br><span class="line">0x1037702B0	0x00007DF8	__DATA	__objc_classrefs</span><br><span class="line">0x1037780A8	0x000058C0	__DATA	__objc_superrefs</span><br><span class="line">0x10377D968	0x00016B0C	__DATA	__objc_ivar</span><br><span class="line">0x103794478	0x000BD7F0	__DATA	__objc_data</span><br><span class="line">0x103851C70	0x00063DED	__DATA	__data</span><br><span class="line">0x1038B5A60	0x000000B8	__DATA	__swift_hooks</span><br><span class="line">0x1038B5B18	0x000000B8	__DATA	__swift51_hooks</span><br><span class="line">0x1038B5BD0	0x0006E528	__DATA	__bss</span><br><span class="line">0x103924400	0x00007090	__DATA	__common</span><br></pre></td></tr></table></figure>

<p>Segment划分为不同的Section，不同的Section存储着不同的信息，下面是一些常用的Section的介绍</p>
<h6 id="TEXT段的Section"><a href="#TEXT段的Section" class="headerlink" title="__TEXT段的Section"></a><strong><code>__TEXT</code></strong>段的<code>Section</code></h6><table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>__text</code></td>
<td>代码节，存放机器编译后的代码</td>
</tr>
<tr>
<td><code>__stubs</code></td>
<td>用于辅助做动态链接代码（<code>dyld</code>）</td>
</tr>
<tr>
<td><code>__stub_helper</code></td>
<td>用于辅助做动态链接</td>
</tr>
<tr>
<td><code>__objc_methname</code></td>
<td>objc的方法名称</td>
</tr>
<tr>
<td><code>__stub_helper</code></td>
<td>用于辅助做动态链接</td>
</tr>
<tr>
<td><code>__cstring</code></td>
<td>代码运行中包含的字符串常量,  例：<code>#define kKey @&quot;123&quot;</code>,  <code>123</code>会存在这个区里</td>
</tr>
<tr>
<td><code>__objc_classname</code></td>
<td>类名</td>
</tr>
<tr>
<td><code>__objc_methtype</code></td>
<td>方法类型</td>
</tr>
<tr>
<td><code>__ustring</code></td>
<td></td>
</tr>
<tr>
<td><code>__gcc_except_tab</code></td>
<td></td>
</tr>
<tr>
<td><code>__const</code></td>
<td>存储<code>const</code>修饰的常量</td>
</tr>
<tr>
<td><code>__dof_RACSignal</code></td>
<td></td>
</tr>
<tr>
<td><code>__dof_RACCompou</code></td>
<td></td>
</tr>
<tr>
<td><code>__unwind_info</code></td>
<td></td>
</tr>
</tbody></table>
<h6 id="DATA段中的-Section"><a href="#DATA段中的-Section" class="headerlink" title="__DATA段中的 Section"></a><strong><code>__DATA</code>段中的 <code>Section</code></strong></h6><table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>__got</code></td>
<td>存储引用符号的实际地址，类似于动态符号表</td>
</tr>
<tr>
<td><code>__la_symbol_ptr</code></td>
<td><code>lazy symbol pointers。</code> 懒加载的函数指针地址。 配合<code>__stubs</code>和<code>stub_helper</code>使用。</td>
</tr>
<tr>
<td><code>__mod_init_func</code></td>
<td>模块初始化的方法</td>
</tr>
<tr>
<td><code>__const</code></td>
<td>存储<code>constant</code>常量的数据。 比如使用<code>extern</code>导出的<code>const</code>修饰的常量。</td>
</tr>
<tr>
<td><code>__cfstring</code></td>
<td><code>Core Foundation</code> 字符串</td>
</tr>
<tr>
<td><code>__objc_classlist</code></td>
<td><code>OC</code>类列表和类信息 映射了<code>__objc_data</code>的地址</td>
</tr>
<tr>
<td><code>__objc_nlclslist</code></td>
<td><code>OC</code> 的 <code>+load</code> 函数列表， 比 <code>__mod_init_func</code> 更早执行</td>
</tr>
<tr>
<td><code>__objc_catlist</code></td>
<td><code>categories</code></td>
</tr>
<tr>
<td><code>__objc_nlcatlist</code></td>
<td>categories<code>的</code>+load`函数列表</td>
</tr>
<tr>
<td><code>__objc_protolist</code></td>
<td>协议列表</td>
</tr>
<tr>
<td><code>__objc_imageinfo</code></td>
<td>镜像信息</td>
</tr>
<tr>
<td><code>__objc_const</code></td>
<td><code>OC</code>常量。保存<code>objc_classdata</code>结构体数据。 用于映射类相关数据的地址，比如类名，方法名等</td>
</tr>
<tr>
<td><code>__objc_selrefs</code></td>
<td>引用的 <code>OC</code> 方法</td>
</tr>
<tr>
<td><code>__objc_protorefs</code></td>
<td>引用的 <code>OC</code> 协议</td>
</tr>
<tr>
<td><code>__objc_classrefs</code></td>
<td>引用的 <code>OC</code> 类</td>
</tr>
<tr>
<td><code>__objc_superrefs</code></td>
<td>引用的 <code>OC</code>超类</td>
</tr>
<tr>
<td><code>__objc_ivar</code></td>
<td><code>ivar</code>指针</td>
</tr>
<tr>
<td><code>__objc_data</code></td>
<td>用于保存类需要的数据。 最主要的内容是映射__objc_const地址， 找到类的相关数据。</td>
</tr>
<tr>
<td><code>__data</code></td>
<td>存放了协议和已经初始化的静态量</td>
</tr>
<tr>
<td><code>__bss</code></td>
<td>存储未初始化的静态量</td>
</tr>
<tr>
<td><code>__common</code></td>
<td>存储导出的全局的数据</td>
</tr>
</tbody></table>
<h5 id="Symbols-部分"><a href="#Symbols-部分" class="headerlink" title="Symbols 部分"></a><code>Symbols</code> 部分</h5><ul>
<li>Address：方法代码的地址</li>
<li>Size：方法占有的空间</li>
<li>File：文件的编号</li>
<li>Name：.o文件里面的方法符号</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Symbols:</span><br><span class="line"># Address	Size    	File  Name</span><br><span class="line">0x100007CCC	0x00000204	[  1] -[UIView(Transform) setAnchorPoint:]</span><br><span class="line">0x100007ED0	0x0000002C	[  1] _CGPointMake</span><br><span class="line">0x100007EFC	0x0000010C	[  2] -[GMCardViewModel excutedGetCardList:completeBlock:]</span><br><span class="line">0x100008008	0x000003CC	[  2] -[GMCardViewModel excuteSkinDetailCardList:]</span><br><span class="line">0x1000083D4	0x0000019C	[  2] ___44-[GMCardViewModel excuteSkinDetailCardList:]_block_invoke</span><br><span class="line">0x100008570	0x00000058	[  2] ___copy_helper_block_e8_32b40w</span><br><span class="line">0x1000085C8	0x00000048	[  2] ___destroy_helper_block_e8_32s40w</span><br><span class="line">0x100008610	0x000004D8	[  2] -[GMCardViewModel excuteGroupFeedCardList:]</span><br><span class="line">0x100008AE8	0x000001B8	[  2] ___43-[GMCardViewModel excuteGroupFeedCardList:]_block_invoke</span><br><span class="line">0x100008CA0	0x000000A4	[  2] ___43-[GMCardViewModel excuteGroupFeedCardList:]_block_invoke.110</span><br><span class="line">0x100008D44	0x000004D8	[  2] -[GMCardViewModel excuteTopicFeedCardList:]</span><br><span class="line">0x10000921C	0x000001B8	[  2] ___43-[GMCardViewModel excuteTopicFeedCardList:]_block_invoke</span><br><span class="line">0x1000093D4	0x000000A4	[  2] ___43-[GMCardViewModel excuteTopicFeedCardList:]_block_invoke_2</span><br><span class="line">0x100009478	0x00000648	[  2] -[GMCardViewModel excuteAIFeedCardList:]</span><br><span class="line">0x100009AC0	0x00000200	[  2] ___40-[GMCardViewModel excuteAIFeedCardList:]_block_invoke</span><br><span class="line">0x100009CC0	0x00000070	[  2] ___copy_helper_block_e8_32s40b48w</span><br><span class="line">0x100009D30	0x00000064	[  2] ___destroy_helper_block_e8_32s40s48w</span><br><span class="line">……</span><br></pre></td></tr></table></figure>

<p>Symbols部分的File顺序适合<strong><code>Target -&gt; Build Phase -&gt; Compile Sources</code></strong>的文件顺序是一致的</p>
<p>二进制重排就是要重新排列这些方法符号的顺序，中心思想就是将启动用到的代码挪到前面位置加载。</p>
<h3 id="order-file"><a href="#order-file" class="headerlink" title="order_file"></a>order_file</h3><p>Xcode提供了排列符号的设置给开发者，设置order_file即可，苹果在一直在做这方面的优化，objc源码就采用了二进制重排优化。</p>
<h4 id="设置order-file"><a href="#设置order-file" class="headerlink" title="设置order_file"></a>设置order_file</h4><p>在根目录生成link.order文件，这里面就是方法符号的排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim xxx_link.order</span><br></pre></td></tr></table></figure>

<p><code>Target -&gt; Build Setting -&gt; Linking -&gt; Order File</code> 设置 <code>order file</code> 的路径</p>
<p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228192825215.png" alt="image-20201228192825215"></p>
<h4 id="编写order-file文件"><a href="#编写order-file文件" class="headerlink" title="编写order_file文件"></a>编写order_file文件</h4><p>编写<code>order_file</code>文件的方式，可以参考<a href="[opensource.apple.com](https://opensource.apple.com/)">obj源码</a>，查看其<code>order_file</code></p>
<p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228193020738.png" alt="image-20201228193020738"></p>
<p>Link Map File文件中符号表是先加载<code>-[AppDelegate application:didFinishLaunchingWithOptions:]</code>其他符号信息，再加载<code>-[AppDelegate setupEnterApp]</code></p>
<p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228193341997.png" alt="image-20201228193341997"></p>
<p>编写一下<code>link.order</code>试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_main</span><br><span class="line">-[AppDelegate setupEnterApp]</span><br><span class="line">-[AppDelegate application:didFinishLaunchingWithOptions:]</span><br></pre></td></tr></table></figure>

<p><code>command + K</code> 后 <code>command + B</code> 再查看一下 <code>Link Map File</code>，顺序已经换过来了</p>
<p><img src="http://qn49kho58.bkt.gdipper.com/image-20201228193941872.png" alt="image-20201228193941872"></p>
<h4 id="自动生成order-file"><a href="#自动生成order-file" class="headerlink" title="自动生成order_file"></a>自动生成order_file</h4><p>全手写容易出现问题，想要自动化就要解决下列问题：</p>
<ul>
<li>保证不遗漏方法</li>
<li>保证方法符号正确</li>
<li>保证方法符号顺序正确</li>
</ul>
<h5 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h5><p><a href="https://mp.weixin.qq.com/s/Drmmx5JtjG3UtTFksL6Q8Q" target="_blank" rel="noopener">《抖音研发实践：基于二进制文件重排的解决方案 APP启动速度提升超15%》</a>，抖音团队使用的静态扫描+运行时trace的方案，能够覆盖80～90%的符号，但是该方法也存在性能瓶颈</p>
<ul>
<li>Initialize hook不到</li>
<li>部分block hook不到</li>
<li>C++通过寄存器的间接函数调用静态扫描不出来</li>
</ul>
<p>为了解决这个问题，需要引入另外一个方案 编译器cha z</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/12/25/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98-%E5%92%8C-%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98/" rel="prev" title="虚拟内存 和 物理内存">
      <i class="fa fa-chevron-left"></i> 虚拟内存 和 物理内存
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/01/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E4%B8%83%E5%A4%A7%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/" rel="next" title="设计模式-七大设计原则">
      设计模式-七大设计原则 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#检测启动时间"><span class="nav-number">1.</span> <span class="nav-text">检测启动时间</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#冷启动和热启动"><span class="nav-number">1.1.</span> <span class="nav-text">冷启动和热启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动时间"><span class="nav-number">1.2.</span> <span class="nav-text">启动时间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#t1阶段：pre-main"><span class="nav-number">1.2.1.</span> <span class="nav-text">t1阶段：pre-main</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#t2阶段"><span class="nav-number">1.2.2.</span> <span class="nav-text">t2阶段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Xcode测量-pre-main-时间"><span class="nav-number">1.3.</span> <span class="nav-text">Xcode测量 pre-main 时间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DYLD-PRINT-STATISTICS"><span class="nav-number">1.3.1.</span> <span class="nav-text">DYLD_PRINT_STATISTICS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加载dylib"><span class="nav-number">1.3.2.</span> <span class="nav-text">加载dylib</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Rebase-Bind"><span class="nav-number">1.3.3.</span> <span class="nav-text">Rebase&#x2F;Bind</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Objc-setup"><span class="nav-number">1.3.4.</span> <span class="nav-text">Objc setup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Initializer-time"><span class="nav-number">1.3.5.</span> <span class="nav-text">Initializer time</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DYLD-PRINT-STATISTICS-DETAILS"><span class="nav-number">1.3.6.</span> <span class="nav-text">DYLD_PRINT_STATISTICS_DETAILS</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#物理内存和虚拟内存"><span class="nav-number">2.</span> <span class="nav-text">物理内存和虚拟内存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内存浪费"><span class="nav-number">2.1.</span> <span class="nav-text">内存浪费</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟内存"><span class="nav-number">2.2.</span> <span class="nav-text">虚拟内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#地址翻译"><span class="nav-number">2.3.</span> <span class="nav-text">地址翻译</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Page-Fault"><span class="nav-number">2.3.1.</span> <span class="nav-text">Page Fault</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#灵活内存管理"><span class="nav-number">2.3.2.</span> <span class="nav-text">灵活内存管理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决安全问题"><span class="nav-number">2.4.</span> <span class="nav-text">解决安全问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二进制重排"><span class="nav-number">3.</span> <span class="nav-text">二进制重排</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么进行二进制重排"><span class="nav-number">3.1.</span> <span class="nav-text">为什么进行二进制重排</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重排目的"><span class="nav-number">3.2.</span> <span class="nav-text">重排目的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看Page-Fault"><span class="nav-number">3.3.</span> <span class="nav-text">查看Page Fault</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Link-Map-File"><span class="nav-number">3.4.</span> <span class="nav-text">Link Map File</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#什么是Link-Map-File文件？"><span class="nav-number">3.4.1.</span> <span class="nav-text">什么是Link Map File文件？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Link-Map-File文件作用"><span class="nav-number">3.4.2.</span> <span class="nav-text">Link Map File文件作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成Link-Map-File"><span class="nav-number">3.4.3.</span> <span class="nav-text">生成Link Map File</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看Link-Map-File文件"><span class="nav-number">3.4.4.</span> <span class="nav-text">查看Link Map File文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#路径部分"><span class="nav-number">3.4.4.1.</span> <span class="nav-text">路径部分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Section部分"><span class="nav-number">3.4.4.2.</span> <span class="nav-text">Section部分</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#TEXT段的Section"><span class="nav-number">3.4.4.2.1.</span> <span class="nav-text">__TEXT段的Section</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#DATA段中的-Section"><span class="nav-number">3.4.4.2.2.</span> <span class="nav-text">__DATA段中的 Section</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Symbols-部分"><span class="nav-number">3.4.4.3.</span> <span class="nav-text">Symbols 部分</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#order-file"><span class="nav-number">3.5.</span> <span class="nav-text">order_file</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#设置order-file"><span class="nav-number">3.5.1.</span> <span class="nav-text">设置order_file</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#编写order-file文件"><span class="nav-number">3.5.2.</span> <span class="nav-text">编写order_file文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自动生成order-file"><span class="nav-number">3.5.3.</span> <span class="nav-text">自动生成order_file</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#解决方案"><span class="nav-number">3.5.3.1.</span> <span class="nav-text">解决方案</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Doris AI</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Doris AI</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.0
  </div>



        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
