<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://dorisgit.github.io').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="KVOæ¦‚è¿° KVOå…¨ç§°æ˜¯key value observingï¼Œä¿—ç§°â€œé”®å€¼ç›‘å¬&#x2F;è§‚å¯Ÿâ€ï¼Œæ˜¯è‹¹æœæä¾›çš„ä¸€å¥—äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡è§‚å¯Ÿ&#x2F;ç›‘å¬å¦ä¸€ä¸ªå¯¹è±¡æŒ‡å®šå±æ€§å€¼çš„å˜åŒ–ï¼Œå½“è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘KVOçš„ç›‘å¬æ–¹æ³•æ¥é€šçŸ¥è§‚å¯Ÿè€…ï¼ŒKVOæ—¶MVCåº”ç”¨ç¨‹åºä¸­çš„å„å±‚ä¹‹å‰è¿›è¡Œé€šä¿¡çš„éå¸¸æœ‰ç”¨çš„æŠ€æœ¯ã€‚ KVO å’Œ NSNotificationéƒ½æ˜¯iosä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§å®ç° KVOå¯ä»¥ç›‘å¬å•ä¸ªå±æ€§çš„å˜åŒ–ï¼Œ">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSâ€”â€”KVOç›¸å…³æ€»ç»“">
<meta property="og:url" content="https://dorisgit.github.io/2020/12/08/iOS%E2%80%94%E2%80%94KVO%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="æ³¡æ³¡èŒ¶å£¶">
<meta property="og:description" content="KVOæ¦‚è¿° KVOå…¨ç§°æ˜¯key value observingï¼Œä¿—ç§°â€œé”®å€¼ç›‘å¬&#x2F;è§‚å¯Ÿâ€ï¼Œæ˜¯è‹¹æœæä¾›çš„ä¸€å¥—äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡è§‚å¯Ÿ&#x2F;ç›‘å¬å¦ä¸€ä¸ªå¯¹è±¡æŒ‡å®šå±æ€§å€¼çš„å˜åŒ–ï¼Œå½“è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘KVOçš„ç›‘å¬æ–¹æ³•æ¥é€šçŸ¥è§‚å¯Ÿè€…ï¼ŒKVOæ—¶MVCåº”ç”¨ç¨‹åºä¸­çš„å„å±‚ä¹‹å‰è¿›è¡Œé€šä¿¡çš„éå¸¸æœ‰ç”¨çš„æŠ€æœ¯ã€‚ KVO å’Œ NSNotificationéƒ½æ˜¯iosä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§å®ç° KVOå¯ä»¥ç›‘å¬å•ä¸ªå±æ€§çš„å˜åŒ–ï¼Œ">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-12-08T12:26:57.000Z">
<meta property="article:modified_time" content="2020-12-11T09:50:28.546Z">
<meta property="article:author" content="Doris AI">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://dorisgit.github.io/2020/12/08/iOS%E2%80%94%E2%80%94KVO%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>iOSâ€”â€”KVOç›¸å…³æ€»ç»“ | æ³¡æ³¡èŒ¶å£¶</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ³¡æ³¡èŒ¶å£¶</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://dorisgit.github.io/2020/12/08/iOS%E2%80%94%E2%80%94KVO%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Doris AI">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ³¡æ³¡èŒ¶å£¶">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOSâ€”â€”KVOç›¸å…³æ€»ç»“
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-08 20:26:57" itemprop="dateCreated datePublished" datetime="2020-12-08T20:26:57+08:00">2020-12-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-11 17:50:28" itemprop="dateModified" datetime="2020-12-11T17:50:28+08:00">2020-12-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="KVOæ¦‚è¿°"><a href="#KVOæ¦‚è¿°" class="headerlink" title="KVOæ¦‚è¿°"></a>KVOæ¦‚è¿°</h3><ul>
<li>KVOå…¨ç§°æ˜¯key value observingï¼Œä¿—ç§°â€œé”®å€¼ç›‘å¬/è§‚å¯Ÿâ€ï¼Œæ˜¯è‹¹æœæä¾›çš„ä¸€å¥—äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡è§‚å¯Ÿ/ç›‘å¬å¦ä¸€ä¸ªå¯¹è±¡æŒ‡å®šå±æ€§å€¼çš„å˜åŒ–ï¼Œå½“è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘KVOçš„ç›‘å¬æ–¹æ³•æ¥é€šçŸ¥è§‚å¯Ÿè€…ï¼ŒKVOæ—¶MVCåº”ç”¨ç¨‹åºä¸­çš„å„å±‚ä¹‹å‰è¿›è¡Œé€šä¿¡çš„éå¸¸æœ‰ç”¨çš„æŠ€æœ¯ã€‚</li>
<li>KVO å’Œ NSNotificationéƒ½æ˜¯iosä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ç§å®ç°</li>
<li>KVOå¯ä»¥ç›‘å¬å•ä¸ªå±æ€§çš„å˜åŒ–ï¼Œä¹Ÿå¯ä»¥ç›‘å¬é›†åˆå¯¹è±¡çš„å˜åŒ–ï¼Œç›‘å¬é›†åˆå¯¹è±¡å˜åŒ–æ—¶ï¼Œéœ€è¦é€šè¿‡KVCçš„mutableValueForKey:ç­‰å¯å˜ä»£ç†æ–¹æ³•è·å¾—é›†åˆä»£ç†å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå½“ä»£ç†å¯¹è±¡çš„å†…éƒ¨å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘KVOçš„ç›‘å¬æ–¹æ³•ã€‚é›†åˆå¯¹è±¡åŒ…å«NSArray å’Œ NSSetã€‚</li>
</ul>
<h3 id="KVOçš„åŸºæœ¬ä½¿ç”¨"><a href="#KVOçš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="KVOçš„åŸºæœ¬ä½¿ç”¨"></a>KVOçš„åŸºæœ¬ä½¿ç”¨</h3><p>KVOä½¿ç”¨æ­¥éª¤ï¼šæ·»åŠ /æ³¨å†ŒKVOç›‘å¬ã€å®ç°ç›‘å¬æ–¹æ³•ä»¥æ¥å—å±æ€§å˜åŒ–é€šçŸ¥ã€ç§»é™¤KVOç›‘å¬</p>
<ol>
<li><p>è°ƒç”¨æ–¹æ³•ç»™è¢«è§‚å¯Ÿå¯¹è±¡æ·»åŠ è§‚å¯Ÿè€…</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath options:(<span class="built_in">NSKeyValueObservingOptions</span>)options context:(<span class="keyword">nullable</span> <span class="keyword">void</span> *)context;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSArray æ·»åŠ </span></span><br><span class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)observer toObjectsAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKeyPath:(<span class="built_in">NSString</span> *)keyPath options:(<span class="built_in">NSKeyValueObservingOptions</span>)options context:(<span class="keyword">nullable</span> <span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨è§‚å¯Ÿè€…ç±»ä¸­å®ç°æ–¹æ³•ä»¥æ¥å—å±æ€§å˜åŒ–çš„é€šçŸ¥æ¶ˆæ¯</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">nullable</span> <span class="keyword">id</span>)object change:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>, <span class="keyword">id</span>&gt; *)change context:(<span class="keyword">nullable</span> <span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“è§‚å¯Ÿè€…ä¸éœ€è¦å†ç›‘å¬æ—¶ï¼Œè°ƒç”¨æ–¹æ³•å°†è§‚å¯Ÿè€…ç§»é™¤ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡³å°‘åœ¨è§‚å¯Ÿè€…é”€æ¯ä¹‹å‰ï¼Œè¿›è¡Œç§»é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´Crash</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath context:(<span class="keyword">nullable</span> <span class="keyword">void</span> *)context API_AVAILABLE(macos(<span class="number">10.7</span>), ios(<span class="number">5.0</span>), watchos(<span class="number">2.0</span>), tvos(<span class="number">9.0</span>));</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSArray ç§»é™¤</span></span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer fromObjectsAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKeyPath:(<span class="built_in">NSString</span> *)keyPath context:(<span class="keyword">nullable</span> <span class="keyword">void</span> *)context API_AVAILABLE(macos(<span class="number">10.7</span>), ios(<span class="number">5.0</span>), watchos(<span class="number">2.0</span>), tvos(<span class="number">9.0</span>));</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer fromObjectsAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="æ³¨å†Œæ–¹æ³•"><a href="#æ³¨å†Œæ–¹æ³•" class="headerlink" title="æ³¨å†Œæ–¹æ³•"></a>æ³¨å†Œæ–¹æ³•</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// æ³¨å†Œè§‚å¯Ÿè€…</span></span><br><span class="line"><span class="comment">/// @param observer è§‚å¯Ÿè€…å¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param keyPath è§‚å¯Ÿå¯¹è±¡å±æ€§è·¯å¾„</span></span><br><span class="line"><span class="comment">/// @param options</span></span><br><span class="line"><span class="comment">///     NSKeyValueObservingOptionNew è§‚å¯Ÿæ–°å€¼</span></span><br><span class="line"><span class="comment">///     NSKeyValueObservingOptionOld è§‚å¯Ÿæ—§å€¼</span></span><br><span class="line"><span class="comment">///     NSKeyValueObservingOptionInitial è§‚å¯Ÿåˆå§‹å€¼ï¼ˆå¦‚æœæƒ³åœ¨æ³¨å†Œè§‚å¯Ÿè€…åç«‹å³æ”¶åˆ°ä¸€æ¬¡é€šçŸ¥ï¼Œå¯ä»¥åŠ å…¥æ­¤å€¼ï¼‰</span></span><br><span class="line"><span class="comment">///     NSKeyValueObservingOptionPrior åˆ†åˆ«åœ¨å€¼æ”¹å˜å‰åè§¦å‘æ–¹æ³•ï¼ˆå³ä¸€æ¬¡ä¿®æ”¹æœ‰ä¸¤æ¬¡è§¦å‘ï¼‰</span></span><br><span class="line"><span class="comment">/// @param context  å¯ä»¥ä¼ å…¥ä»»æ„æ•°æ®ï¼ˆä»»æ„ç±»å‹çš„å¯¹è±¡æˆ–è€…CæŒ‡é’ˆï¼‰ï¼Œåœ¨ç›‘å¬æ–¹æ³•ä¸­å¯ä»¥æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®ï¼Œæ˜¯KVOä¸­çš„ä¸€ç§ä¼ å€¼æ–¹å¼ï¼Œ</span></span><br><span class="line"><span class="comment">///                 å¦‚æœä¼ çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åœ¨ç§»é™¤è§‚å¯Ÿä¹‹å‰æŒæœ‰å®ƒçš„å¼ºå¼•ç”¨ï¼Œå¦åˆ™åœ¨ç›‘å¬æ–¹æ³•ä¸­è®¿é—®contextå°±å¯èƒ½å¯¼è‡´Crash</span></span><br><span class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath options:(<span class="built_in">NSKeyValueObservingOptions</span>)options context:(<span class="keyword">nullable</span> <span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>

<h4 id="ç›‘å¬æ–¹æ³•"><a href="#ç›‘å¬æ–¹æ³•" class="headerlink" title="ç›‘å¬æ–¹æ³•"></a>ç›‘å¬æ–¹æ³•</h4><p>å¦‚æœå¯¹è±¡è¢«æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…ï¼Œåˆ™è¯¥å¯¹è±¡å¿…é¡»èƒ½å“åº”ä¸€ä¸‹ç›‘å¬æ–¹æ³•ï¼Œå³è¯¥å¯¹è±¡æ‰€å±ç±»ä¸­å¿…é¡»å®ç°ç›‘å¬æ–¹æ³•ã€‚å½“è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ä¼šè°ƒç”¨ç›‘å¬æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å®ç°åˆ™ä¼šCrashã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ç›‘å¬æ–¹æ³•</span></span><br><span class="line"><span class="comment">/// @param keyPath è§‚å¯Ÿå¯¹è±¡å±æ€§è·¯å¾„</span></span><br><span class="line"><span class="comment">/// @param object è§‚å¯Ÿå¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param change</span></span><br><span class="line"><span class="comment">/// å­—å…¸ NSDictionary&lt;NSKeyValueChangeKey, id&gt;ï¼Œå±æ€§å€¼æ›´æ”¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ ¹æ®æ³¨å†Œæ–¹æ³•ä¸­optionså‚æ•°ä¼ å…¥çš„æšä¸¾æ¥è¿”å›</span></span><br><span class="line"><span class="comment">/// keyä¸º NSKeyValueChangeKey æšä¸¾ç±»å‹</span></span><br><span class="line"><span class="comment">/// &#123;</span></span><br><span class="line"><span class="comment">/// 1.NSKeyValueChangeKindKeyï¼šå­˜å‚¨æœ¬æ¬¡æ”¹å˜çš„ä¿¡æ¯ï¼ˆchangeå­—å…¸ä¸­é»˜è®¤åŒ…å«è¿™ä¸ªkeyï¼‰</span></span><br><span class="line"><span class="comment">/// &#123;</span></span><br><span class="line"><span class="comment">/// å¯¹åº”æšä¸¾ç±»å‹ NSKeyValueChange</span></span><br><span class="line"><span class="comment">///     typedef NS_ENUM(NSUInteger, NSKeyValueChange) &#123;</span></span><br><span class="line"><span class="comment">///         NSKeyValueChangeSetting     = 1,</span></span><br><span class="line"><span class="comment">///         NSKeyValueChangeInsertion   = 2,</span></span><br><span class="line"><span class="comment">///         NSKeyValueChangeRemoval     = 3,</span></span><br><span class="line"><span class="comment">///         NSKeyValueChangeReplacement = 4</span></span><br><span class="line"><span class="comment">///&#125;;</span></span><br><span class="line"><span class="comment">/// å¦‚æœæ˜¯å¯¹è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§ï¼ˆåŒ…æ‹¬é›†åˆï¼‰è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œkind å­—æ®µçš„å€¼ä¸º NSKeyValueChangeSetting</span></span><br><span class="line"><span class="comment">/// å¦‚æœè¢«è§‚å¯Ÿçš„æ˜¯é›†åˆå¯¹è±¡ï¼Œä¸”è¿›è¡Œçš„æ˜¯ï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›¿æ¢ï¼‰æ“ä½œï¼Œåˆ™ä¼šæ ¹æ®é›†åˆå¯¹è±¡çš„æ“ä½œæ–¹å¼æ¥è®¾ç½® kind å­—æ®µçš„å€¼</span></span><br><span class="line"><span class="comment">/// æ’å…¥ï¼šNSKeyValueChangeInsertion</span></span><br><span class="line"><span class="comment">/// åˆ é™¤ï¼šNSKeyValueChangeRemoval</span></span><br><span class="line"><span class="comment">/// æ›¿æ¢ï¼šNSKeyValueChangeReplacement</span></span><br><span class="line"></span><br><span class="line"><span class="comment">///&#125;</span></span><br><span class="line"><span class="comment">/// 2.NSKeyValueChangeNewKeyï¼šå­˜å‚¨æ–°å€¼ï¼ˆå¦‚æœoptionsä¸­ä¼ å…¥NSKeyValueObservingOptionNewï¼Œchangeå­—å…¸ä¸­å°±ä¼šåŒ…å«è¿™ä¸ªkeyï¼‰</span></span><br><span class="line"><span class="comment">/// 3.NSKeyValueChangeOldKeyï¼šå­˜å‚¨æ—§å€¼ï¼ˆå¦‚æœoptionsä¸­ä¼ å…¥NSKeyValueObservingOptionOldï¼Œchangeå­—å…¸ä¸­å°±ä¼šåŒ…å«è¿™ä¸ªkeyï¼‰</span></span><br><span class="line"><span class="comment">/// 4.NSKeyValueChangeIndexesKeyï¼šå¦‚æœè¢«è§‚å¯Ÿçš„æ˜¯é›†åˆå¯¹è±¡ï¼Œä¸”è¿›è¡Œçš„æ˜¯ï¼ˆæ’å…¥ã€åˆ é™¤ã€æ›¿æ¢ï¼‰æ“ä½œï¼Œåˆ™changeå­—å…¸ä¸­å°±ä¼šåŒ…å«è¿™ä¸ªkeyï¼Œ</span></span><br><span class="line"><span class="comment">/// è¿™ä¸ªkeyçš„valueæ˜¯ä¸€ä¸ªNSIndexSetå¯¹è±¡ï¼ŒåŒ…å«æ›´æ”¹å…³ç³»ä¸­çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">/// 5.NSKeyValueChangeNotificationIsPriorKeyï¼šå¦‚æœoptionsä¸­ä¼ å…¥NSKeyValueObservingOptionPriorï¼Œåˆ™åœ¨æ”¹å˜å‰é€šçŸ¥çš„changeå­—å…¸ä¸­ä¼šåŒ…å«è¿™ä¸ªkeyã€‚</span></span><br><span class="line"><span class="comment">/// è¿™ä¸ªkeyå¯¹åº”çš„valueæ˜¯NSNumberåŒ…è£…çš„YESï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯åœ¨æ”¹å˜å‰çš„é€šçŸ¥[change[NSKeyValueChangeNotificationIsPriorKey] boolValue] == YES]</span></span><br><span class="line"><span class="comment">/// @param context æ³¨å†Œæ–¹æ³•ä¸­ä¼ å…¥çš„context</span></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>

<h4 id="ç§»é™¤æ–¹æ³•"><a href="#ç§»é™¤æ–¹æ³•" class="headerlink" title="ç§»é™¤æ–¹æ³•"></a>ç§»é™¤æ–¹æ³•</h4><p>åœ¨è°ƒç”¨æ³¨å†Œæ–¹æ³•åï¼ŒKVOä¸ä¼šå¯¹è§‚å¯Ÿè€…è¿›è¡Œå¼ºå¼•ç”¨ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„è§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸï¼Œè‡³å°‘éœ€è¦åœ¨è§‚å¯Ÿè€…é”€æ¯ä¹‹è°¦ï¼Œè°ƒç”¨ç§»é™¤ç›‘å¬æ–¹æ³•ï¼Œå¦åˆ™åœ¨è§‚å¯Ÿè€…è¢«é‡Šæ”¾åï¼Œå†æ¬¡è§¦å‘KVOç›‘å¬æ–¹æ³•å°±ä¼šCrashã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ç§»é™¤è§‚å¯Ÿè€…</span></span><br><span class="line"><span class="comment">/// @param observer è§‚å¯Ÿå¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param keyPath è§‚å¯Ÿå¯¹è±¡è·¯å¾„</span></span><br><span class="line"><span class="comment">/// @param context æ³¨å†Œä¼ å…¥çš„context</span></span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath context:(<span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>

<h4 id="ä¸¾ä¸ªğŸŒ°"><a href="#ä¸¾ä¸ªğŸŒ°" class="headerlink" title="ä¸¾ä¸ªğŸŒ°"></a>ä¸¾ä¸ªğŸŒ°</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)add_newKey_kvo &#123;</span><br><span class="line">    [<span class="keyword">self</span>.person addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionInitial</span> context:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context; &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@--%@--%@--%@"</span>,keyPath,object,change,context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>======Log======</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">15</span>:<span class="number">57</span>:<span class="number">49</span>] -[MMKVO observeValueForKeyPath:ofObject:change:context:] [ç¬¬<span class="number">61</span>è¡Œ] ğŸ’• name--&lt;MMKVOPerson: <span class="number">0x600002a04100</span>&gt;--&#123;</span><br><span class="line">    kind = <span class="number">1</span>;</span><br><span class="line">    new = <span class="string">"&lt;null&gt;"</span>;</span><br><span class="line">&#125;--(null)</span><br><span class="line"></span><br><span class="line">[<span class="number">15</span>:<span class="number">57</span>:<span class="number">49</span>] -[MMKVO observeValueForKeyPath:ofObject:change:context:] [ç¬¬<span class="number">61</span>è¡Œ] ğŸ’• name--&lt;MMKVOPerson: <span class="number">0x600002a04100</span>&gt;--&#123;</span><br><span class="line">    kind = <span class="number">1</span>;</span><br><span class="line">    new = <span class="number">123</span>;</span><br><span class="line">&#125;--(null)</span><br></pre></td></tr></table></figure>

<h4 id="å®é™…åº”ç”¨"><a href="#å®é™…åº”ç”¨" class="headerlink" title="å®é™…åº”ç”¨"></a>å®é™…åº”ç”¨</h4><p>KVOä¸»è¦ç”¨æ¥åšé”®å€¼è§‚å¯Ÿæ“ä½œï¼Œæƒ³è¦ä¸€ä¸ªå€¼å‘ç”Ÿæ”¹å˜åé€šçŸ¥å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ç”¨KVOå®ç°æœ€ä¸ºåˆé€‚ã€‚</p>
<p>View-Model-Controllerä¹‹é—´æ•°æ®ä¼ é€’</p>
<h4 id="KVOè§¦å‘ç›‘å¬æ–¹æ³•çš„æ–¹å¼"><a href="#KVOè§¦å‘ç›‘å¬æ–¹æ³•çš„æ–¹å¼" class="headerlink" title="KVOè§¦å‘ç›‘å¬æ–¹æ³•çš„æ–¹å¼"></a>KVOè§¦å‘ç›‘å¬æ–¹æ³•çš„æ–¹å¼</h4><p>KVOè§¦å‘åˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘</p>
<h5 id="è‡ªåŠ¨è§¦å‘"><a href="#è‡ªåŠ¨è§¦å‘" class="headerlink" title="è‡ªåŠ¨è§¦å‘"></a>è‡ªåŠ¨è§¦å‘</h5><ul>
<li>å¦‚æœæ˜¯ç›‘å¬å¯¹è±¡ç‰¹å®šå±æ€§å€¼çš„æ”¹å˜ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æ”¹å˜å±æ€§å€¼ä¼šè§¦å‘KVOï¼›<ol>
<li>ä½¿ç”¨ç‚¹è¯­æ³•</li>
<li>ä½¿ç”¨setteræ–¹æ³•</li>
<li>ä½¿ç”¨KVCçš„setValue:ForKey:æ–¹æ³•ï¼ˆkeyä¸º<code>&lt;key&gt;</code>ï¼Œ<code>_&lt;key&gt;</code>ä¸ä¼šè§¦å‘ï¼‰</li>
<li>ä½¿ç”¨KVCçš„setValue:ForKeyPath:æ–¹æ³•ï¼ˆkeyä¸º<code>&lt;key&gt;</code>ï¼Œ<code>_&lt;key&gt;</code>ä¸ä¼šè§¦å‘ï¼‰</li>
</ol>
</li>
<li>å¦‚æœæ˜¯ç›‘å¬é›†åˆå¯¹è±¡çš„æ”¹å˜ï¼Œéœ€è¦é€šè¿‡KVCçš„mutableArrayValueForKey:ç­‰æ–¹æ³•è·å–ä»£ç†å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå½“ä»£ç†å¯¹è±¡çš„å†…éƒ¨å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘KVOã€‚é›†åˆå¯¹è±¡åŒ…å«NSArray å’Œ NSSetã€‚</li>
</ul>
<h5 id="æ‰‹åŠ¨è§¦å‘"><a href="#æ‰‹åŠ¨è§¦å‘" class="headerlink" title="æ‰‹åŠ¨è§¦å‘"></a>æ‰‹åŠ¨è§¦å‘</h5><ul>
<li><p>æ™®é€šå¯¹è±¡å±æ€§æˆ–æ˜¯æˆå‘˜å˜é‡ä½¿ç”¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)willChangeValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)didChangeValueForKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
</li>
<li><p>NSArrayã€NSSetå¯¹è±¡ä½¿ç”¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)willChange:(<span class="built_in">NSKeyValueChange</span>)changeKind valuesAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)didChange:(<span class="built_in">NSKeyValueChange</span>)changeKind valuesAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="KVOçš„è¿›é˜¶ä½¿ç”¨"><a href="#KVOçš„è¿›é˜¶ä½¿ç”¨" class="headerlink" title="KVOçš„è¿›é˜¶ä½¿ç”¨"></a>KVOçš„è¿›é˜¶ä½¿ç”¨</h3><h4 id="observationInfoå±æ€§"><a href="#observationInfoå±æ€§" class="headerlink" title="observationInfoå±æ€§"></a>observationInfoå±æ€§</h4><ul>
<li><code>observationInfo</code>å±æ€§æ˜¯<code>NSKeyValueObserving.h</code>æ–‡ä»¶ä¸­ç³»ç»Ÿé€šè¿‡åˆ†ç±»ç»™<code>NSObject</code>æ·»åŠ çš„å±æ€§ï¼Œæ‰€ä»¥æ‰€æœ‰ç»§æ‰¿äº<code>NSObject</code>çš„å¯¹è±¡éƒ½å«æœ‰è¯¥å±æ€§ï¼›</li>
<li>å¯ä»¥é€šè¿‡<code>observationInfo</code>å±æ€§æŸ¥çœ‹è¢«è§‚å¯Ÿå¯¹è±¡çš„å…¨éƒ¨è§‚å¯Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬<code>observer</code>ã€<code>keyPath</code>ã€<code>options</code>ã€<code>context</code>ç­‰ã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nullable) void *observationInfo NS_RETURNS_INNER_POINTER;</span><br></pre></td></tr></table></figure>

<h4 id="contextçš„ä½¿ç”¨"><a href="#contextçš„ä½¿ç”¨" class="headerlink" title="contextçš„ä½¿ç”¨"></a>contextçš„ä½¿ç”¨</h4><p>æ³¨å†Œæ–¹æ³•addObserver:forKey:options:context:ä¸­contextå¯ä»¥ä¼ å…¥ä»»æ„æ•°æ®ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç›‘å¬æ–¹æ³•ä¸­æ¥æ”¶åˆ°è¿™ä¸ªæ•°æ®ã€‚</p>
<ul>
<li><p>contextå·¦å³ï¼šæ ‡ç­¾ï¼Œå¯ä»¥æ›´ç²¾ç¡®çš„ç¡®å®šè¢«è§‚å¯Ÿå¯¹è±¡å±æ€§ï¼Œç”¨äºç»§æ‰¿ã€å¤šç›‘å¬ï¼›ä¹Ÿå¯ç”¨äºä¼ å€¼</p>
<p>KVOåªæœ‰ä¸€ä¸ªç›‘å¬å›è°ƒæ–¹æ³•<code>observeValueForKeyPath:ofObject:change:context:</code>ï¼Œæˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹å¯ä»¥åœ¨æ³¨å†Œæ–¹æ³•ä¸­æŒ‡å®šcontextä¸ºNULLï¼Œå¹¶åœ¨ç›‘å¬æ–¹æ³•ä¸­é€šè¿‡object å’Œ keyPathæ¥åˆ¤æ–­è§¦å‘KVOçš„æ¥æº</p>
<p>ä½†æ˜¯å¦‚æœå­˜åœ¨ç»§æ‰¿çš„æƒ…å†µï¼Œå­ç±»å’Œçˆ¶ç±»éƒ½å¯¹åŒä¸€ä¸ªå±æ€§è¿›è¡Œäº†è§‚å¯Ÿï¼Œå½“å±æ€§å˜åŒ–æ—¶å€™ç”±è°æ¥è¿›è¡Œå¤„ç†ï¼Œé€šè¿‡contextå°±èƒ½å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨æ³¨å†Œæ–¹æ³•ä¸­ä¸ºcontextè®¾ç½®ä¸€ä¸ªç‹¬ç«‹æ— äºŒçš„å€¼ï¼Œç„¶ååœ¨ç›‘å¬æ–¹æ³•ä¸­å¯¹contextè¿›è¡Œæ ¡éªŒå³å¯</p>
</li>
<li><p>è‹¹æœæ¨èç”¨æ³•ï¼šç”¨contextæ¥å‡†ç¡®çš„ç¼ºç‚¹è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§ï¼Œä½¿ç”¨å”¯ä¸€å‘½åçš„é™æ€å˜é‡åœ°å€ä½œä¸ºcontextçš„å€¼ã€‚å¯ä»¥ä¸ºæ•´ä¸ªç±»è®¾ç½®ä¸€ä¸ªcontextï¼Œç„¶ååœ¨ç›‘å¬æ–¹æ³•ä¸­é€šè¿‡object å’Œ keypathæ¥ç¡®å®šè¢«è§‚å¯Ÿå±æ€§ï¼Œè¿™æ ·å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µå°±å¯ä»¥é€šè¿‡contextæ¥åˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªè¢«è§‚å¯Ÿå¯¹è±¡æ•°é‡è®¾ç½®ä¸åŒçš„contextï¼Œè¿™æ ·ä½¿ç”¨contextå°±èƒ½ç²¾ç¡®çš„ç¡®å®šè¢«è§‚å¯Ÿå¯¹è±¡å±æ€§ã€‚</p>
</li>
</ul>
<p>ä»¥SDWebImageæºç ä¸ºä¾‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> * SDMemoryCacheContext = &amp;SDMemoryCacheContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œç›‘å¬</span></span><br><span class="line">[config addObserver:<span class="keyword">self</span> forKeyPath:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(maxMemoryCost)) options:<span class="number">0</span> context:SDMemoryCacheContext];</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="keyword">if</span> (context == SDMemoryCacheContext) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(maxMemoryCost))]) &#123;</span><br><span class="line">            <span class="keyword">self</span>.totalCostLimit = <span class="keyword">self</span>.config.maxMemoryCost;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([keyPath isEqualToString:<span class="built_in">NSStringFromSelector</span>(<span class="keyword">@selector</span>(maxMemoryCount))]) &#123;</span><br><span class="line">            <span class="keyword">self</span>.countLimit = <span class="keyword">self</span>.config.maxMemoryCount;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">super</span> observeValueForKeyPath:keyPath ofObject:object change:change context:context];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>contextä¼˜ç‚¹ï¼šåµŒå¥—å°‘ï¼Œæ€§èƒ½é«˜ï¼Œæ›´å®‰å…¨ã€æ‰©å±•æ€§å¼º</li>
<li>contextæ³¨æ„ç‚¹ï¼š<ol>
<li>å¦‚æœä¼ çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åœ¨ç§»é™¤è§‚å¯Ÿä¹‹å‰æŒæœ‰å®ƒçš„å¼ºå¼•ç”¨ï¼Œå¦åˆ™åœ¨ç›‘å¬æ–¹æ³•ä¸­è®¿é—®<code>context</code>å°±å¯èƒ½Crash</li>
<li>ç©ºä¼ NULL è€Œä¸åº”è¯¥ä¼ nil</li>
</ol>
</li>
</ul>
<p>ç›´æ¥å‡ºç°Crash</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MMKVOPerson *person = [MMKVOPerson new];</span><br><span class="line">person.name = <span class="string">@"person"</span>;</span><br><span class="line">[<span class="keyword">self</span>.person addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionInitial</span> context:(__bridge <span class="keyword">void</span> * _Nullable)(person)];</span><br><span class="line"></span><br><span class="line">Thread <span class="number">1</span>: EXC_BAD_ACCESS (code=<span class="number">1</span>, address=<span class="number">0x64b6f2e7498c</span>)</span><br></pre></td></tr></table></figure>

<h4 id="KVOçš„è‡ªåŠ¨è§¦å‘æ§åˆ¶"><a href="#KVOçš„è‡ªåŠ¨è§¦å‘æ§åˆ¶" class="headerlink" title="KVOçš„è‡ªåŠ¨è§¦å‘æ§åˆ¶"></a>KVOçš„è‡ªåŠ¨è§¦å‘æ§åˆ¶</h4><p>é€šè¿‡åœ¨è¢«è§‚å¯Ÿå¯¹è±¡çš„ç±»ä¸­é‡å†™<code>automaticallyNotifiesObserversForKey:</code>æ–¹æ³•æ¥æ§åˆ¶<code>KVO</code>çš„è‡ªåŠ¨è§¦å‘ï¼Œé€šè¿‡æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åªè®©å¤–ç•Œè§‚å¯Ÿç±»ä¸­çš„æŸäº›å±æ€§çš„å˜åŒ–</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)automaticallyNotifiesObserversForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@"name"</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">super</span> automaticallyNotifiesObserversForKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">20</span>:<span class="number">03</span>:<span class="number">19</span>] -[MMKVO observeValueForKeyPath:ofObject:change:context:] [ç¬¬<span class="number">108</span>è¡Œ] ğŸ’• name--&lt;MMKVOPerson: <span class="number">0x600000e28dd0</span>&gt;--&#123;</span><br><span class="line">    kind = <span class="number">1</span>;</span><br><span class="line">    new = <span class="string">"&lt;null&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¯¹äºæ³¨å†Œç›‘å¬<code>option</code>åŒ…å«çš„<code>NSKeyValueObservingOptionInitial</code>çš„è§‚å¯Ÿå¯¹è±¡ï¼Œä¼šåœ¨æ³¨å†Œè§‚å¯Ÿè€…åç«‹å³æ”¶åˆ°ä¸€æ¬¡é€šçŸ¥ã€‚</p>
<p>ä¹Ÿå¯ä»¥å®ç°éµå¾ªå‘½åè§„åˆ™ä¸º<code>+ (BOOL)automaticallyNotifiesObserversOf&lt;Key&gt;</code>çš„æ–¹æ³•æ¥å•ä¸€æ§åˆ¶å±æ€§çš„KVOè‡ªåŠ¨è§¦å‘ï¼Œ<code>&lt;key&gt;</code>ä¸ºå±æ€§åï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)automaticallyNotifiesObserversOfName;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ–¹æ³•çš„ä¼˜å…ˆçº§é«˜äºç¬¬äºŒä¸ªæ–¹æ³•ã€‚å¦‚æœå®ç°äº†<code>automaticallyNotifiesObserversForKey:</code>æ–¹æ³•ï¼Œå¹¶å¯¹<code>&lt;key&gt;</code>åšäº†å¤„ç†ï¼Œåˆ™ç³»ç»Ÿä¸ä¼šå†è°ƒç”¨ <code>&lt;key&gt;</code>çš„<code>automaticallyNotifiesObserversOf&lt;Key&gt;</code></li>
<li>optionsæŒ‡å®šçš„<code>NSKeyValueObservingOptionInitial</code>è§¦å‘çš„<code>KVO</code>é€šçŸ¥ï¼Œæ˜¯æ— æ³•è¢«<code>automaticallyNotifiesObserversForKey:</code>é˜»æ­¢</li>
</ul>
</blockquote>
<h4 id="KVOçš„æ‰‹åŠ¨è§¦å‘"><a href="#KVOçš„æ‰‹åŠ¨è§¦å‘" class="headerlink" title="KVOçš„æ‰‹åŠ¨è§¦å‘"></a>KVOçš„æ‰‹åŠ¨è§¦å‘</h4><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><ul>
<li>ä½¿ç”¨KVOç›‘å¬æˆå‘˜å˜é‡å€¼çš„æ”¹å˜ï¼›</li>
<li>åœ¨æŸäº›éœ€è¦æ§åˆ¶ç›‘å¬è¿‡ç¨‹çš„åœºæ™¯ä¸‹ï¼š<ol>
<li>ä¸ºäº†å°½é‡å‡å°‘ä¸å¿…è¦çš„è§¦å‘é€šçŸ¥æ“ä½œ</li>
<li>å½“å¤šä¸ªæ›´æ”¹åŒæ—¶å…·å¤‡çš„æ—¶å€™æ‰è°ƒç”¨å±æ€§æ”¹å˜çš„ç›‘å¬æ–¹æ³•</li>
</ol>
</li>
</ul>
<h5 id="è§¦å‘æ–¹å¼"><a href="#è§¦å‘æ–¹å¼" class="headerlink" title="è§¦å‘æ–¹å¼"></a>è§¦å‘æ–¹å¼</h5><ul>
<li>ç”±äºKVOçš„æœ¬è´¨ï¼Œé‡å†™setteræ–¹æ³•æ¥è¾¾åˆ°å¯ä»¥é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„ç›®çš„ï¼Œæ‰€ä»¥åªæœ‰é€šè¿‡setteræ–¹æ³•æˆ–è€…KVCæ–¹æ³•å»ä¿®æ”¹å±æ€§å˜é‡å€¼çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘KVOï¼Œç›´æ¥ä¿®æ”¹æˆå‘˜å˜é‡æ˜¯ä¸ä¼šè§¦å‘KVOã€‚</li>
<li>å½“æˆ‘ä»¬è¦ä½¿ç”¨KVOç›‘å¬æˆå‘˜å˜é‡å€¼æ”¹å˜çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åœ¨ä¸ºæˆå‘˜å˜é‡èµ‹å€¼çš„å‰åæ‰‹åŠ¨è°ƒç”¨willChangeValueForKey: å’Œ didChangeValueForKey:ä¸¤ä¸ªæ–¹æ³•æ¥æ‰‹åŠ¨è§¦å‘KVOã€‚</li>
<li>NSKeyValueObservingOptionPriorï¼ˆåˆ†åˆ«åœ¨å€¼æ”¹å˜å‰åè§¦å‘æ–¹æ³•ï¼Œå³ä¸€æ¬¡ä¿®æ”¹æœ‰ä¸¤æ¬¡è§¦å‘ï¼‰ï¼Œä¸¤æ¬¡è§¦å‘åˆ†åˆ«åœ¨willChangeValueForKey: å’Œ didChangeValueForKey:çš„æ—¶å€™è¿›è¡Œã€‚</li>
<li>å¦‚æœæ³¨å†Œæ–¹æ³•ä¸­optionsä¼ å…¥NSKeyValueObservingOptionPriorï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å€¼è°ƒç”¨willChangeValueForKey:æ¥è§¦å‘æ”¹å˜å‰çš„é‚£æ¬¡KVOï¼Œå¯ä»¥ç”¨äºåœ¨å±æ€§å³å°†æ”¹å˜æ—¶åšä¸€äº›æ“ä½œã€‚</li>
</ul>
<h4 id="KVOæ–°æ—§å€¼ç›¸ç­‰æ—¶ä¸è§¦å‘"><a href="#KVOæ–°æ—§å€¼ç›¸ç­‰æ—¶ä¸è§¦å‘" class="headerlink" title="KVOæ–°æ—§å€¼ç›¸ç­‰æ—¶ä¸è§¦å‘"></a>KVOæ–°æ—§å€¼ç›¸ç­‰æ—¶ä¸è§¦å‘</h4><p>æ§åˆ¶KVOç›‘å¬çš„å±æ€§å€¼ä¿®æ”¹å‰åç›¸ç­‰æ—¶ï¼Œä¸è§¦å‘KVOçš„ç›‘å¬æ–¹æ³•ï¼Œå¯ä»¥ç»“åˆè‡ªåŠ¨è§¦å‘å’Œæ‰‹åŠ¨è§¦å‘æ¥å®ç°ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)automaticallyNotifiesObserversForKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">BOOL</span> automatic = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@"name"</span>]) &#123;</span><br><span class="line">        automatic = <span class="literal">NO</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        automatic = [<span class="keyword">super</span> automaticallyNotifiesObserversForKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> automatic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (![_name isEqualToString:name]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"name"</span>];</span><br><span class="line">        _name = name;</span><br><span class="line">        [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"name"</span>];</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ‰‹åŠ¨è§‚å¯Ÿé›†åˆå±æ€§"><a href="#æ‰‹åŠ¨è§‚å¯Ÿé›†åˆå±æ€§" class="headerlink" title="æ‰‹åŠ¨è§‚å¯Ÿé›†åˆå±æ€§"></a>æ‰‹åŠ¨è§‚å¯Ÿé›†åˆå±æ€§</h4><p>æ‰‹åŠ¨è§¦å‘ç›‘å¬æ–¹æ³•APIï¼ˆæ•°ç»„ï¼‰</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)willChange:(<span class="built_in">NSKeyValueChange</span>)changeKind valuesAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)didChange:(<span class="built_in">NSKeyValueChange</span>)changeKind valuesAtIndexes:(<span class="built_in">NSIndexSet</span> *)indexes forKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ¹æ®<code>KVC</code>çš„<code>NSMutableArray</code>æœç´¢æ¨¡å¼ï¼š</p>
<ul>
<li>è‡³å°‘è¦å®ç°ä¸€ä¸ªæ’å…¥å’Œä¸€ä¸ªåˆ é™¤æ–¹æ³•ï¼Œéƒ½åœ¨ä¸ä¼šè§¦å‘<code>KVO</code><ol>
<li>æ’å…¥æ–¹æ³•ï¼š<code>insertObject:in&lt;Key&gt;AtIndex:</code>æˆ–<code>insert&lt;Key&gt;:atIndexes:</code> </li>
<li>åˆ é™¤æ–¹æ³•ï¼š<code>removeObjectFrom&lt;Key&gt;AtIndex:</code>æˆ–<code>remove&lt;Key&gt;AtIndexes:</code></li>
</ol>
</li>
<li>å¯ä»¥ä¸å®ç°æ›¿æ¢æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä¸å®ç°æ›¿æ¢æ–¹æ³•ï¼Œæ‰§è¡Œæ›¿æ¢æ“ä½œæ—¶ï¼ŒKVOä¼šæŠŠå®ƒå½“æˆå…ˆåˆ é™¤åæ·»åŠ ï¼Œå³ä¼šè§¦å‘ä¸¤æ¬¡<code>KVO</code>ã€‚ç¬¬ä¸€æ¬¡è§¦å‘<code>KVO</code>ä¸­<code>change</code>å­—å…¸çš„<code>old</code>é”®çš„å€¼ä¸ºæ›¿æ¢å‰çš„å…ƒç´ ï¼Œç¬¬äºŒæ¬¡è§¦å‘çš„<code>KVO</code>ä¸­<code>change</code>å­—å…¸çš„<code>new</code>é”®çš„å€¼ä¸ºæ›¿æ¢åçš„å…ƒç´ ï¼Œå‰ææ¡ä»¶æ˜¯æ³¨å†Œæ–¹æ³•ä¸­çš„<code>options</code>ä¼ å…¥å¯¹äºçš„æšä¸¾å€¼ã€‚</li>
<li>å¦‚æœå®ç°æ›¿æ¢æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œæ›¿æ¢æ“ä½œåªä¼šè§¦å‘ä¸€æ¬¡<code>KVO</code>ï¼Œå¹¶ä¸”<code>change</code>å­—å…¸ä¼šåŒæ—¶åŒ…å«<code>new</code>å’Œ<code>old</code>ï¼Œå‰ææ¡ä»¶æ˜¯æ³¨å†Œæ–¹æ³•ä¸­çš„<code>options</code>ä¸­ä¼ å…¥äº†å¯¹äºçš„æšä¸¾å€¼ã€‚<ol>
<li>æ›¿æ¢æ–¹æ³•ï¼š<code>replaceObjectIn&lt;Key&gt;AtIndex:withObject:</code>æˆ–<code>replace&lt;Key&gt;AtIndexes:with&lt;Key&gt;:</code></li>
</ol>
</li>
<li>å»ºè®®å®ç°æ›¿æ¢æ–¹æ³•ä»¥æé«˜æ€§èƒ½</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    BOOL automatic &#x3D; NO;</span><br><span class="line">    if ([key isEqualToString:@&quot;mArray&quot;]) &#123;</span><br><span class="line">        automatic &#x3D; NO;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        automatic &#x3D; [super automaticallyNotifiesObserversForKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">    return automatic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)insertMArray:(NSArray *)array atIndexes:(NSIndexSet *)indexes</span><br><span class="line">&#123;</span><br><span class="line">    [self willChange:NSKeyValueChangeInsertion valuesAtIndexes:indexes forKey:@&quot;mArray&quot;];</span><br><span class="line">    [self.mArray insertObjects:array atIndexes:indexes];</span><br><span class="line">    [self didChange:NSKeyValueChangeInsertion valuesAtIndexes:indexes forKey:@&quot;mArray&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeMArrayAtIndexes:(NSIndexSet *)indexes</span><br><span class="line">&#123;</span><br><span class="line">    [self willChange:NSKeyValueChangeRemoval valuesAtIndexes:indexes forKey:@&quot;mArray&quot;];</span><br><span class="line">    [self.mArray removeObjectsAtIndexes:indexes];</span><br><span class="line">    [self didChange:NSKeyValueChangeRemoval valuesAtIndexes:indexes forKey:@&quot;mArray&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)replaceMArrayAtIndexes:(NSIndexSet *)indexes withMArray:(NSArray *)array</span><br><span class="line">&#123;</span><br><span class="line">    [self willChange:NSKeyValueChangeReplacement valuesAtIndexes:indexes forKey:@&quot;mArray&quot;];</span><br><span class="line">    [self.mArray replaceObjectsAtIndexes:indexes withObjects:array];</span><br><span class="line">    [self didChange:NSKeyValueChangeReplacement valuesAtIndexes:indexes forKey:@&quot;mArray&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="KVOçš„ä¾èµ–è§‚å¯Ÿ"><a href="#KVOçš„ä¾èµ–è§‚å¯Ÿ" class="headerlink" title="KVOçš„ä¾èµ–è§‚å¯Ÿ"></a>KVOçš„ä¾èµ–è§‚å¯Ÿ</h4><h5 id="ä¸€å¯¹ä¸€å…³ç³»"><a href="#ä¸€å¯¹ä¸€å…³ç³»" class="headerlink" title="ä¸€å¯¹ä¸€å…³ç³»"></a>ä¸€å¯¹ä¸€å…³ç³»</h5><p>æœ‰äº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå±æ€§çš„æ”¹å˜ä¾èµ–äºèƒŒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯è¯´å½“åˆ«çš„å±æ€§éäº†ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬å¯¹<code>Download</code>ç±»ä¸­çš„<code>downloadProgress</code>å±æ€§è¿›è¡Œ<code>KVO</code>ç›‘å¬ï¼Œæ”¹å±æ€§çš„æ”¹å˜ä¾èµ–äº<code>writtenData</code> å’Œ <code>totalData</code>å±æ€§çš„æ”¹å˜ã€‚è§‚å¯Ÿè€…ç›‘å¬äº†<code>downloadProgress</code>ï¼Œå½“<code>writtenData</code> å’Œ <code>totalData</code>å±æ€§å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§‚å¯Ÿè€…ä¹Ÿåº”è¯¥è¢«é€šçŸ¥ã€‚</p>
<ol>
<li><p>é‡å†™<code>keyPathsForValuesAffectingValueForKey:</code>æ–¹æ³•æŒ‡æ˜å±æ€§ä¾èµ–äº <code>writtenData</code> å’Œ <code>totalData</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSSet</span>&lt;<span class="built_in">NSString</span> *&gt; *)keyPathsForValuesAffectingValueForKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSSet</span> *keyPaths = [<span class="keyword">super</span> keyPathsForValuesAffectingValueForKey:key];</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@"downloadProgress"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSArray</span> *affectingKeys = @[<span class="string">@"writtenData"</span>,<span class="string">@"totalData"</span>];</span><br><span class="line">        keyPaths = [keyPaths setByAddingObjectsFromArray:affectingKeys];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> keyPaths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ç°ä¸€ä¸ªéµå¾ªå‘½åè§„åˆ™ä¸º<code>keyPathsForValuesAffecting&lt;Key&gt;</code>çš„ç±»æ–¹æ³•ï¼Œ<code>&lt;key&gt;</code>æ˜¯ä¾èµ–äºå…¶ä»–å€¼çš„å±æ€§åï¼ˆé¦–å­—æ¯å¤§å°ï¼‰</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSSet</span>&lt;<span class="built_in">NSString</span> *&gt; *)keyPathsForValuesAffectingDownloadProgress</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@"writtenData"</span>,<span class="string">@"totalData"</span>, <span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä¸”éƒ½ä¼šè°ƒç”¨ï¼Œä½†æ˜¯æœ€ç»ˆç»“æœä¼šä»¥<code>keyPathsForValuesAffectingValueForKey:</code>ä¸ºå‡†ã€‚</p>
</blockquote>
<h5 id="ä¸€å¯¹å¤šå…³ç³»"><a href="#ä¸€å¯¹å¤šå…³ç³»" class="headerlink" title="ä¸€å¯¹å¤šå…³ç³»"></a>ä¸€å¯¹å¤šå…³ç³»</h5><p>ä»¥ä¸Šæ–¹æ³•åœ¨è§‚å¯Ÿé›†åˆå±æ€§æ—¶å°±ä¸ç®¡ç”¨äº†ã€‚ä¾‹å¦‚ï¼Œå‡å¦‚ä½ æœ‰ä¸€ä¸ª Department ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªè£…æœ‰ Employee ç±»çš„å®ä¾‹å¯¹è±¡çš„æ•°ç»„ï¼ŒEmployee ç±»æœ‰ salary å±æ€§ã€‚ä½ å¸Œæœ› Department ç±»æœ‰ä¸€ä¸ª totalSalary å±æ€§æ¥è®¡ç®—æ‰€æœ‰å‘˜å·¥çš„è–ªæ°´ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªå…³ç³»ä¸­ Department çš„ totalSalary ä¾èµ–äºæ‰€æœ‰ Employee å®ä¾‹å¯¹è±¡çš„ salary å±æ€§ã€‚ä»¥ä¸‹æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<ol>
<li><p>ä½ å¯ä»¥ç”¨<code>KVO</code>å°† parentï¼ˆæ¯”å¦‚ Department ï¼‰ä½œä¸ºæ‰€æœ‰ childrenï¼ˆæ¯”å¦‚ Employee ï¼‰ç›¸å…³å±æ€§çš„è§‚å¯Ÿè€…ã€‚ä½ å¿…é¡»åœ¨æŠŠ child æ·»åŠ æˆ–åˆ é™¤åˆ° parent æ—¶æŠŠ parent ä½œä¸º child çš„è§‚å¯Ÿè€…æ·»åŠ æˆ–åˆ é™¤ã€‚åœ¨<code>observeValueForKeyPath:ofObject:change:context:</code>æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥é’ˆå¯¹è¢«ä¾èµ–é¡¹çš„å˜æ›´æ¥æ›´æ–°ä¾èµ–é¡¹çš„å€¼ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"Department.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> *totalSalaryContext = &amp;totalSalaryContext;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Department</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSArray</span>&lt;Employee *&gt; *employees;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSNumber</span> *totalSalary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Department</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithEmployees:(<span class="built_in">NSArray</span> *)employees</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.employees = [employees <span class="keyword">copy</span>];</span><br><span class="line">        <span class="keyword">for</span> (Employee *em <span class="keyword">in</span> <span class="keyword">self</span>.employees) &#123;</span><br><span class="line">            [em addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"salary"</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> context:totalSalaryContext];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span> *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (context == totalSalaryContext) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setTotalSalary:[<span class="keyword">self</span> valueForKeyPath:<span class="string">@"employees.@sum.salary"</span>]];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">super</span> observeValueForKeyPath:keyPath ofObject:object change:change context:context];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">- (<span class="keyword">void</span>)setTotalSalary:(<span class="built_in">NSNumber</span> *)totalSalary</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_totalSalary != totalSalary) &#123;</span><br><span class="line">        [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"totalSalary"</span>];</span><br><span class="line">        _totalSalary = totalSalary;</span><br><span class="line">        [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"totalSalary"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (Employee *em <span class="keyword">in</span> <span class="keyword">self</span>.employees) &#123;</span><br><span class="line">        [em removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"salary"</span> context:totalSalaryContext];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨iOSä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„å¦å¤–ä¸€ç§å®ç°æ–¹å¼ï¼šé€šçŸ¥ï¼ˆNSNotificationï¼‰</p>
</li>
</ol>
<h3 id="KVOçš„ä½¿ç”¨æ³¨æ„"><a href="#KVOçš„ä½¿ç”¨æ³¨æ„" class="headerlink" title="KVOçš„ä½¿ç”¨æ³¨æ„"></a>KVOçš„ä½¿ç”¨æ³¨æ„</h3><h4 id="ç§»é™¤è§‚å¯Ÿè€…çš„æ³¨æ„ç‚¹"><a href="#ç§»é™¤è§‚å¯Ÿè€…çš„æ³¨æ„ç‚¹" class="headerlink" title="ç§»é™¤è§‚å¯Ÿè€…çš„æ³¨æ„ç‚¹"></a>ç§»é™¤è§‚å¯Ÿè€…çš„æ³¨æ„ç‚¹</h4><ul>
<li>åœ¨è°ƒç”¨KVOæ³¨å†Œæ–¹æ³•åï¼ŒKVOå¹¶ä¸ä¼šå¯¹è§‚å¯Ÿè€…è¿›è¡Œå¼ºå¼•ç”¨ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„è§‚å¯Ÿè€…çš„ç”Ÿå‘½å‘¨æœŸã€‚è‡³å°‘éœ€è¦åœ¨è§‚å¯Ÿè€…é”€æ¯ä¹‹å‰ï¼Œè°ƒç”¨KVOç§»é™¤æ–¹æ³•ç§»é™¤è§‚å¯Ÿè€…ï¼Œå¦åˆ™å¦‚æœè§‚å¯Ÿè€…è¢«é‡Šæ”¾åï¼Œå†æ¬¡è§¦å‘KVOç›‘å¬æ–¹æ³•å°±ä¼šCrashã€‚</li>
<li>KVOçš„æ³¨å†Œæ–¹æ³•å’Œç§»é™¤æ–¹æ³•åº”è¯¥æ˜¯æˆå¯¹çš„ï¼Œå¦‚æœé‡å¤è°ƒç”¨ç§»é™¤æ–¹æ³•ï¼Œå°±ä¼šæŠ›å‡ºNSRangeExceptionå¹¶å¯¼è‡´Crashã€‚</li>
<li>è‹¹æœæ¨èçš„æ–¹å¼æ˜¯ï¼Œåœ¨è§‚å¯Ÿè€…åˆå§‹åŒ–æœŸé—´ï¼ˆinit æˆ– viewDidLoadçš„æ—¶å€™ï¼‰æ³¨å†Œä¸ºè§‚å¯Ÿè€…ï¼Œåœ¨é‡Šæ”¾ï¼ˆdeallocï¼‰æ—¶è°ƒç”¨ç§»é™¤æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä»–ä»¬æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒç†æƒ³çš„æ–¹å¼ã€‚</li>
</ul>
<h4 id="é˜²æ­¢å¤šæ¬¡æ³¨å†Œ-å’Œ-ç§»é™¤ç›¸åŒçš„KVO"><a href="#é˜²æ­¢å¤šæ¬¡æ³¨å†Œ-å’Œ-ç§»é™¤ç›¸åŒçš„KVO" class="headerlink" title="é˜²æ­¢å¤šæ¬¡æ³¨å†Œ å’Œ ç§»é™¤ç›¸åŒçš„KVO"></a>é˜²æ­¢å¤šæ¬¡æ³¨å†Œ å’Œ ç§»é™¤ç›¸åŒçš„KVO</h4><p>æœ‰æ—¶å€™æˆ‘ä»¬éš¾ä»¥é¿å…å¤šæ¬¡æ³¨å†Œ å’Œ ç§»é™¤KVOï¼Œæˆ–è€…ç§»é™¤äº†ä¸€ä¸ªæœªæ³¨å†Œçš„è§‚å¯Ÿè€…ï¼Œä»è€Œäº§ç”Ÿå¯èƒ½ä¼šå¯¼è‡´Crashçš„é£é™©ã€‚</p>
<h5 id="é»‘ç§‘æŠ€é˜²æ­¢å¤šæ¬¡æ·»åŠ åˆ é™¤KVOå‡ºç°çš„é—®é¢˜"><a href="#é»‘ç§‘æŠ€é˜²æ­¢å¤šæ¬¡æ·»åŠ åˆ é™¤KVOå‡ºç°çš„é—®é¢˜" class="headerlink" title="é»‘ç§‘æŠ€é˜²æ­¢å¤šæ¬¡æ·»åŠ åˆ é™¤KVOå‡ºç°çš„é—®é¢˜"></a>é»‘ç§‘æŠ€é˜²æ­¢å¤šæ¬¡æ·»åŠ åˆ é™¤KVOå‡ºç°çš„é—®é¢˜</h5><p>æ ¸å¿ƒï¼šåˆ©ç”¨runtimeå®ç°æ–¹æ³•äº¤æ¢ï¼Œè¿›è¡Œæ‹¦æˆª<code>add</code>  å’Œ <code>remove</code> è¿›è¡Œæ“ä½œã€‚</p>
<h6 id="æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨-try-catch"><a href="#æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨-try-catch" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨@try @catch"></a>æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨@try @catch</h6><p>åˆ©ç”¨@try @catchæ•è·å¼‚å¸¸ï¼Œä¸è®©ç¨‹åºCrashï¼Œä½†æ˜¯åªèƒ½é’ˆå¯¹å¤šæ¬¡åˆ é™¤<code>KVO</code>çš„å¤„ç†</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">kvoRemove</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    [<span class="keyword">self</span> swizzleInstanceMethod:<span class="keyword">@selector</span>(removeObserver:forKeyPath:) withSelector:<span class="keyword">@selector</span>(swizzle_removeObserver:forKeyPath:)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)swizzle_removeObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath &#123;</span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        [<span class="keyword">self</span> swizzle_removeObserver:observer forKeyPath:keyPath];</span><br><span class="line">    &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h6 id="æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨æ¨¡å‹æ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®"><a href="#æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨æ¨¡å‹æ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨æ¨¡å‹æ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®"></a>æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨æ¨¡å‹æ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®</h6><p>åˆ©ç”¨æ¨¡å‹æ•°æ®è¿›è¡Œå­˜å‚¨è®°å½•</p>
<ul>
<li>åˆ©ç”¨<code>runtime</code>ï¼Œæ‹¦æˆªç›‘å¬å¯¹è±¡ å’Œ <code>keyPath</code></li>
<li>åˆ©ç”¨æ¨¡å‹å­˜å‚¨æ‰§è¡Œ<code>addObserver</code>å¯¹è±¡ å’Œ ç›‘å¬çš„<code>KeyPath</code></li>
<li>è¿›è¡Œå­˜å‚¨æ ¡éªŒï¼Œä¸å­˜åœ¨äºæ¨¡å‹ä¸­çš„<code>addObserver</code>å¯¹è±¡ å’Œ ç›‘å¬çš„<code>KeyPath</code>ï¼Œæ‰è¿›è¡Œ<code>addObserver</code></li>
<li><code>remove</code>çš„æ—¶å€™åŒæ ·è¿›è¡Œæ ¡éªŒä¸€ä¸‹</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSKVOCache</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">/// arrayM</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="built_in">NSMutableArray</span> *&gt; *dictM;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSKVOCache</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)shareInshance &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSKVOCache</span> *_instance;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        _instance = [<span class="built_in">NSKVOCache</span> new];</span><br><span class="line">        _instance.dictM = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _instance;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">kvoRemove</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    [<span class="keyword">self</span> swizzleInstanceMethod:<span class="keyword">@selector</span>(removeObserver:forKeyPath:)</span><br><span class="line">                   withSelector:<span class="keyword">@selector</span>(swizzle_removeObserver:forKeyPath:)];</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> swizzleInstanceMethod:<span class="keyword">@selector</span>(addObserver:forKeyPath:options:context:)</span><br><span class="line">                   withSelector:<span class="keyword">@selector</span>(swizzle_addObserver:forKeyPath:options:context:)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)swizzle_removeObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSKVOCache</span> *kvo = [<span class="built_in">NSKVOCache</span> shareInshance];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arrayM = kvo.dictM[keyPath];</span><br><span class="line">    <span class="keyword">if</span> (arrayM &amp;&amp; [arrayM containsObject:observer]) &#123;</span><br><span class="line">        [arrayM removeObject:observer];</span><br><span class="line">        [<span class="keyword">self</span> swizzle_removeObserver:observer forKeyPath:keyPath];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)swizzle_addObserver:(<span class="built_in">NSObject</span> *)observer forKeyPath:(<span class="built_in">NSString</span> *)keyPath options:(<span class="built_in">NSKeyValueObservingOptions</span>)options context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSKVOCache</span> *kvo = [<span class="built_in">NSKVOCache</span> shareInshance];</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *arrayM = kvo.dictM[keyPath];</span><br><span class="line">    <span class="keyword">if</span> (!arrayM) &#123;</span><br><span class="line">        arrayM = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        [kvo.dictM setObject:arrayM forKey:keyPath];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (![arrayM containsObject:observer]) &#123;</span><br><span class="line">        [arrayM addObject:observer];</span><br><span class="line">        [<span class="keyword">self</span> swizzle_addObserver:observer forKeyPath:keyPath options:options context:context];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h6 id="æ–¹æ¡ˆä¸‰ï¼šåˆ©ç”¨obserationInfoé‡Œç§æœ‰å±æ€§"><a href="#æ–¹æ¡ˆä¸‰ï¼šåˆ©ç”¨obserationInfoé‡Œç§æœ‰å±æ€§" class="headerlink" title="æ–¹æ¡ˆä¸‰ï¼šåˆ©ç”¨obserationInfoé‡Œç§æœ‰å±æ€§"></a>æ–¹æ¡ˆä¸‰ï¼šåˆ©ç”¨<code>obserationInfo</code>é‡Œç§æœ‰å±æ€§</h6><p><code>obserationInfo</code>å±æ€§åŒ…å«å±æ€§çš„ç›‘å¬è€…ï¼Œé€šçŸ¥è€…ï¼Œä»¥åŠç›‘å¬çš„<code>keyPath</code>ï¼Œé€šè¿‡ç§æœ‰å±æ€§ç›´æ¥æ‹¿åˆ°å½“å‰å¯¹è±¡æ‰€ç›‘å¬çš„<code>keyPath</code>ï¼Œå’Œ<code>observer</code></p>
<p>å®ç°ä¸Šå’Œæ–¹æ¡ˆäºŒåŸºæœ¬ä¸€ç›´ï¼Œåªä¸è¿‡å¯ä»¥é€šè¿‡<code>obserationInfo</code>å……å½“æˆ‘ä»¬å‰é¢çš„<code>NSKVOCache</code>çš„åŠŸèƒ½ï¼Œè¿›è¡Œæ ¡éªŒ</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿›è¡Œæ£€ç´¢è·å–Key</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)observerKeyPath:(<span class="built_in">NSString</span> *)key observer:(<span class="keyword">id</span> )observer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">id</span> info = <span class="keyword">self</span>.observationInfo;</span><br><span class="line">    <span class="built_in">NSArray</span> *array = [info valueForKey:<span class="string">@"_observances"</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">id</span> objc <span class="keyword">in</span> array) &#123;</span><br><span class="line">        <span class="keyword">id</span> Properties = [objc valueForKeyPath:<span class="string">@"_property"</span>];</span><br><span class="line">        <span class="keyword">id</span> newObserver = [objc valueForKeyPath:<span class="string">@"_observer"</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSString</span> *keyPath = [Properties valueForKeyPath:<span class="string">@"_keyPath"</span>];</span><br><span class="line">        <span class="keyword">if</span> ([key isEqualToString:keyPath] &amp;&amp; [newObserver isEqual:observer]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å…¶ä»–æ³¨æ„ç‚¹"><a href="#å…¶ä»–æ³¨æ„ç‚¹" class="headerlink" title="å…¶ä»–æ³¨æ„ç‚¹"></a>å…¶ä»–æ³¨æ„ç‚¹</h4><ul>
<li>å¦‚æœå¯¹è±¡è¢«æ³¨å†Œæˆä¸ºè§‚å¯Ÿè€…ï¼Œåˆ™è¯¥å¯¹è±¡å¿…é¡»å®ç°èƒ½å“åº”çš„ç›‘å¬æ–¹æ³•ï¼Œå½“å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶å°±ä¼šè°ƒç”¨ç›‘å¬æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰å®ç°ï¼Œä¼šç›´æ¥Crashã€‚</li>
<li><code>keyPath</code>ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ºé¿å…å†™é”™ï¼Œå¯ä»¥ä½¿ç”¨<code>NSStringFromSelector(@selector(propertyName))</code>ï¼Œå°†å±æ€§çš„getteræ–¹æ³•SELè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå¯¹keyPathè¿›è¡Œæ ¡éªŒ</li>
<li>å¦‚æœæ³¨å†Œæ–¹æ³•ä¸­<code>context</code>ä¼ çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åœ¨ç§»é™¤è§‚å¯Ÿä¹‹å‰æŒæœ‰å®ƒçš„å¼ºå¼•ç”¨ï¼Œå¦åˆ™ç›‘å¬æ–¹æ³•ä¸­è®¿é—®<code>context</code>å°±å¯èƒ½å¯¼è‡´Crashã€‚</li>
<li>å¦‚æœç›‘å¬é›†åˆå¯¹è±¡çš„æ”¹å˜ï¼Œéœ€è¦é€šè¿‡<code>KVC</code>çš„<code>mutableArrayValueForKey:</code>ç­‰æ–¹æ³•è·å¾—ä»£ç†å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå½“ä»£ç†å¯¹è±¡çš„å†…éƒ¨å¯¹è±¡å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘<code>KVO</code>ã€‚å¦‚æœç›´æ¥å¯¹é›†åˆå¯¹è±¡è¿›è¡Œæ“ä½œæ”¹å˜ï¼Œä¸ä¼šè§¦å‘<code>KVO</code>ã€‚</li>
<li>åœ¨è§‚å¯Ÿè€…ç±»çš„ç›‘å¬æ–¹æ³•ä¸­ï¼Œåº”è¯¥ä¸ºæ— æ³•è¯†åˆ«çš„<code>context</code> æˆ–è€… <code>object</code>ã€keyPathè°ƒç”¨çˆ¶ç±»çš„<code>[super observeValueForKeyPath:keyPath ofObject:object change:change context:context];</code></li>
</ul>
<h3 id="KVOå®ç°åŸç†"><a href="#KVOå®ç°åŸç†" class="headerlink" title="KVOå®ç°åŸç†"></a>KVOå®ç°åŸç†</h3><h4 id="isa-swizzling"><a href="#isa-swizzling" class="headerlink" title="isa-swizzling"></a>isa-swizzling</h4><p>è‹¹æœä½¿ç”¨äº†isaæ··å†™æŠ€æœ¯ï¼ˆisa-swizzlingï¼‰æ¥å®ç°KVOï¼Œå½“æˆ‘ä»¬è°ƒç”¨addObserver:forKeyPath:options:context:æ–¹æ³•ä¸ºinstanceæ·»åŠ KVOç›‘å¬åï¼Œç³»ç»Ÿä¼šåœ¨è¿è¡Œæ—¶åˆ©äºRuntime APIåŠ¨æ€åˆ›å»ºinstanceå¯¹è±¡æ‰€å±ç±»çš„å­ç±»NSKVONotifying_Aï¼Œå¹¶ä¸”è®©instanceå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è¿™ä¸ªå…¨æ–°çš„å­ç±»ï¼Œå¹¶é‡å†™åŸç±»çš„è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•æ¥è¾¾åˆ°å¯ä»¥é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„ç›®çš„ã€‚</p>
<ul>
<li>è¿™ä¸ªå­ç±»æŒ‡å‘å®ƒè‡ªå·±çš„meta-classå¯¹è±¡ï¼Œè€Œä¸æ˜¯åŸç±»çš„meta-classå¯¹è±¡</li>
<li>é‡å†™çš„setteræ–¹æ³•çš„SELå¯¹è±¡çš„IMPä¸ºFoundationä¸­çš„<code>_NSSetXXXValueAndNotify</code>å‡½æ•°ï¼ˆXXXä¸ºkeyçš„æ•°æ®ç±»å‹ï¼‰ï¼Œå½“è¢«è§‚å¯Ÿçš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨_NSSetXXXValueAndNotifyå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸­è°ƒç”¨ï¼š<ol>
<li>willChangeValueForKey:æ–¹æ³•</li>
<li>çˆ¶ç±»åŸæ¥çš„setteræ–¹æ³•</li>
<li>didChangeValueForKey:æ–¹æ³•ï¼ˆå†…éƒ¨è§¦å‘observerç›‘å¬æ–¹æ³•observeValueForKeyPath:ofObject:change:context:ï¼‰</li>
</ol>
</li>
<li>åœ¨ç§»é™¤KVOç›‘å¬åï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„isaä¼šæŒ‡å›åŸç±»Aï¼Œä½†æ˜¯NSKVONotifying_Aç±»å¹¶æ²¡æœ‰é”€æ¯ï¼Œè¿˜æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­</li>
</ul>
<h4 id="KVOåŠ¨æ€ç”Ÿæˆçš„å­ç±»éƒ½æœ‰å“ªäº›æ–¹æ³•"><a href="#KVOåŠ¨æ€ç”Ÿæˆçš„å­ç±»éƒ½æœ‰å“ªäº›æ–¹æ³•" class="headerlink" title="KVOåŠ¨æ€ç”Ÿæˆçš„å­ç±»éƒ½æœ‰å“ªäº›æ–¹æ³•"></a>KVOåŠ¨æ€ç”Ÿæˆçš„å­ç±»éƒ½æœ‰å“ªäº›æ–¹æ³•</h4><p>NSKVONotifying_Aé™¤äº†é‡å†™setteræ–¹æ³•ï¼Œè¿˜æ˜¯é‡å†™äº†classã€deallocã€_isKVOè¿™ä¸‰ä¸ªæ–¹æ³•ï¼ˆå¯ä»¥ä½¿ç”¨runtimeçš„class_copyMethodListå‡½æ•°æ‰“å°æ–¹æ³•åˆ—è¡¨è·å–ï¼‰ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>Class:class æ–¹æ³•è¿”å›çš„æ˜¯çˆ¶ç±»çš„classå¯¹è±¡ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¸è®©å¤–ç•ŒçŸ¥é“KVOåŠ¨æ€ç”Ÿæˆç±»çš„å­˜åœ¨ï¼›</li>
<li>Dealloc:é‡Šæ”¾KVOä½¿ç”¨è¿‡ç¨‹äº§ç”Ÿçš„ä¸œè¥¿</li>
<li>_isKVO:ç”¨æ¥æ ‡ç¤ºå®ƒæ˜¯ä¸€ä¸ªKVOçš„ç±»</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/17/iOS%E2%80%94%E2%80%94KVC%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/" rel="prev" title="iOSâ€”â€”KVCç›¸å…³æ€»ç»“">
      <i class="fa fa-chevron-left"></i> iOSâ€”â€”KVCç›¸å…³æ€»ç»“
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/14/%E6%9B%B4%E6%94%B9AppStore%E5%85%AC%E5%8F%B8%E4%BF%A1%E6%81%AF/" rel="next" title="æ›´æ”¹AppStoreå…¬å¸ä¿¡æ¯">
      æ›´æ”¹AppStoreå…¬å¸ä¿¡æ¯ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#KVOæ¦‚è¿°"><span class="nav-number">1.</span> <span class="nav-text">KVOæ¦‚è¿°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KVOçš„åŸºæœ¬ä½¿ç”¨"><span class="nav-number">2.</span> <span class="nav-text">KVOçš„åŸºæœ¬ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ³¨å†Œæ–¹æ³•"><span class="nav-number">2.1.</span> <span class="nav-text">æ³¨å†Œæ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç›‘å¬æ–¹æ³•"><span class="nav-number">2.2.</span> <span class="nav-text">ç›‘å¬æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç§»é™¤æ–¹æ³•"><span class="nav-number">2.3.</span> <span class="nav-text">ç§»é™¤æ–¹æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸¾ä¸ªğŸŒ°"><span class="nav-number">2.4.</span> <span class="nav-text">ä¸¾ä¸ªğŸŒ°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®é™…åº”ç”¨"><span class="nav-number">2.5.</span> <span class="nav-text">å®é™…åº”ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOè§¦å‘ç›‘å¬æ–¹æ³•çš„æ–¹å¼"><span class="nav-number">2.6.</span> <span class="nav-text">KVOè§¦å‘ç›‘å¬æ–¹æ³•çš„æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è‡ªåŠ¨è§¦å‘"><span class="nav-number">2.6.1.</span> <span class="nav-text">è‡ªåŠ¨è§¦å‘</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ‰‹åŠ¨è§¦å‘"><span class="nav-number">2.6.2.</span> <span class="nav-text">æ‰‹åŠ¨è§¦å‘</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KVOçš„è¿›é˜¶ä½¿ç”¨"><span class="nav-number">3.</span> <span class="nav-text">KVOçš„è¿›é˜¶ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#observationInfoå±æ€§"><span class="nav-number">3.1.</span> <span class="nav-text">observationInfoå±æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contextçš„ä½¿ç”¨"><span class="nav-number">3.2.</span> <span class="nav-text">contextçš„ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOçš„è‡ªåŠ¨è§¦å‘æ§åˆ¶"><span class="nav-number">3.3.</span> <span class="nav-text">KVOçš„è‡ªåŠ¨è§¦å‘æ§åˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOçš„æ‰‹åŠ¨è§¦å‘"><span class="nav-number">3.4.</span> <span class="nav-text">KVOçš„æ‰‹åŠ¨è§¦å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ä½¿ç”¨åœºæ™¯"><span class="nav-number">3.4.1.</span> <span class="nav-text">ä½¿ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#è§¦å‘æ–¹å¼"><span class="nav-number">3.4.2.</span> <span class="nav-text">è§¦å‘æ–¹å¼</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOæ–°æ—§å€¼ç›¸ç­‰æ—¶ä¸è§¦å‘"><span class="nav-number">3.5.</span> <span class="nav-text">KVOæ–°æ—§å€¼ç›¸ç­‰æ—¶ä¸è§¦å‘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ‰‹åŠ¨è§‚å¯Ÿé›†åˆå±æ€§"><span class="nav-number">3.6.</span> <span class="nav-text">æ‰‹åŠ¨è§‚å¯Ÿé›†åˆå±æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOçš„ä¾èµ–è§‚å¯Ÿ"><span class="nav-number">3.7.</span> <span class="nav-text">KVOçš„ä¾èµ–è§‚å¯Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ä¸€å¯¹ä¸€å…³ç³»"><span class="nav-number">3.7.1.</span> <span class="nav-text">ä¸€å¯¹ä¸€å…³ç³»</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ä¸€å¯¹å¤šå…³ç³»"><span class="nav-number">3.7.2.</span> <span class="nav-text">ä¸€å¯¹å¤šå…³ç³»</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KVOçš„ä½¿ç”¨æ³¨æ„"><span class="nav-number">4.</span> <span class="nav-text">KVOçš„ä½¿ç”¨æ³¨æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç§»é™¤è§‚å¯Ÿè€…çš„æ³¨æ„ç‚¹"><span class="nav-number">4.1.</span> <span class="nav-text">ç§»é™¤è§‚å¯Ÿè€…çš„æ³¨æ„ç‚¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é˜²æ­¢å¤šæ¬¡æ³¨å†Œ-å’Œ-ç§»é™¤ç›¸åŒçš„KVO"><span class="nav-number">4.2.</span> <span class="nav-text">é˜²æ­¢å¤šæ¬¡æ³¨å†Œ å’Œ ç§»é™¤ç›¸åŒçš„KVO</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#é»‘ç§‘æŠ€é˜²æ­¢å¤šæ¬¡æ·»åŠ åˆ é™¤KVOå‡ºç°çš„é—®é¢˜"><span class="nav-number">4.2.1.</span> <span class="nav-text">é»‘ç§‘æŠ€é˜²æ­¢å¤šæ¬¡æ·»åŠ åˆ é™¤KVOå‡ºç°çš„é—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨-try-catch"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">æ–¹æ¡ˆä¸€ï¼šåˆ©ç”¨@try @catch</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨æ¨¡å‹æ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®"><span class="nav-number">4.2.1.2.</span> <span class="nav-text">æ–¹æ¡ˆäºŒï¼šåˆ©ç”¨æ¨¡å‹æ•°ç»„è¿›è¡Œå­˜å‚¨æ•°æ®</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#æ–¹æ¡ˆä¸‰ï¼šåˆ©ç”¨obserationInfoé‡Œç§æœ‰å±æ€§"><span class="nav-number">4.2.1.3.</span> <span class="nav-text">æ–¹æ¡ˆä¸‰ï¼šåˆ©ç”¨obserationInfoé‡Œç§æœ‰å±æ€§</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å…¶ä»–æ³¨æ„ç‚¹"><span class="nav-number">4.3.</span> <span class="nav-text">å…¶ä»–æ³¨æ„ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KVOå®ç°åŸç†"><span class="nav-number">5.</span> <span class="nav-text">KVOå®ç°åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#isa-swizzling"><span class="nav-number">5.1.</span> <span class="nav-text">isa-swizzling</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KVOåŠ¨æ€ç”Ÿæˆçš„å­ç±»éƒ½æœ‰å“ªäº›æ–¹æ³•"><span class="nav-number">5.2.</span> <span class="nav-text">KVOåŠ¨æ€ç”Ÿæˆçš„å­ç±»éƒ½æœ‰å“ªäº›æ–¹æ³•</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Doris AI</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Doris AI</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme â€“ <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.0
  </div>



        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
