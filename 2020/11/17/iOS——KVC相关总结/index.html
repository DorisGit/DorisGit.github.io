<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://dorisgit.github.io').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="KVC KVC å…¨ç§°æ˜¯ï¼ˆKey-Value Codingï¼‰é”®å€¼ç¼–ç ï¼Œæ˜¯æœ‰NSKeyValueCodingéæ­£å¼åè®®å¯ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œå¯¹è±¡é‡‡ç”¨è¿™ç§æœºåˆ¶æ¥æä¾›å¯¹å…¶å±æ€§çš„é—´æ¥è®¿é—®ï¼Œå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–å…¶å…³è”çš„å­˜å–æ–¹æ³•ï¼ˆsetter or getterï¼‰ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å­˜å‚¨æ–¹æ³•æˆ–å˜é‡åæ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡KVCé—´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸”KVCè¿˜å¯ä»¥è®¿é—®ç§æœ‰å˜é‡ã€‚æŸäº›æƒ…">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSâ€”â€”KVCç›¸å…³æ€»ç»“">
<meta property="og:url" content="https://dorisgit.github.io/2020/11/17/iOS%E2%80%94%E2%80%94KVC%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="æ³¡æ³¡èŒ¶å£¶">
<meta property="og:description" content="KVC KVC å…¨ç§°æ˜¯ï¼ˆKey-Value Codingï¼‰é”®å€¼ç¼–ç ï¼Œæ˜¯æœ‰NSKeyValueCodingéæ­£å¼åè®®å¯ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œå¯¹è±¡é‡‡ç”¨è¿™ç§æœºåˆ¶æ¥æä¾›å¯¹å…¶å±æ€§çš„é—´æ¥è®¿é—®ï¼Œå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–å…¶å…³è”çš„å­˜å–æ–¹æ³•ï¼ˆsetter or getterï¼‰ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å­˜å‚¨æ–¹æ³•æˆ–å˜é‡åæ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡KVCé—´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸”KVCè¿˜å¯ä»¥è®¿é—®ç§æœ‰å˜é‡ã€‚æŸäº›æƒ…">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://dorisgit.github.io/Users/mikasa/Desktop/image_mark/image-20201208151209139.png">
<meta property="article:published_time" content="2020-11-17T08:02:22.000Z">
<meta property="article:modified_time" content="2020-12-08T12:26:04.193Z">
<meta property="article:author" content="Doris AI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dorisgit.github.io/Users/mikasa/Desktop/image_mark/image-20201208151209139.png">

<link rel="canonical" href="https://dorisgit.github.io/2020/11/17/iOS%E2%80%94%E2%80%94KVC%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>iOSâ€”â€”KVCç›¸å…³æ€»ç»“ | æ³¡æ³¡èŒ¶å£¶</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ³¡æ³¡èŒ¶å£¶</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://dorisgit.github.io/2020/11/17/iOS%E2%80%94%E2%80%94KVC%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Doris AI">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ³¡æ³¡èŒ¶å£¶">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          iOSâ€”â€”KVCç›¸å…³æ€»ç»“
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-17 16:02:22" itemprop="dateCreated datePublished" datetime="2020-11-17T16:02:22+08:00">2020-11-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-08 20:26:04" itemprop="dateModified" datetime="2020-12-08T20:26:04+08:00">2020-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="KVC"><a href="#KVC" class="headerlink" title="KVC"></a>KVC</h3><ul>
<li>KVC å…¨ç§°æ˜¯ï¼ˆKey-Value Codingï¼‰é”®å€¼ç¼–ç ï¼Œæ˜¯æœ‰<code>NSKeyValueCoding</code>éæ­£å¼åè®®å¯ç”¨çš„ä¸€ç§æœºåˆ¶ï¼Œå¯¹è±¡é‡‡ç”¨è¿™ç§æœºåˆ¶æ¥æä¾›å¯¹å…¶å±æ€§çš„é—´æ¥è®¿é—®ï¼Œå¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ¥è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–å…¶å…³è”çš„å­˜å–æ–¹æ³•ï¼ˆ<code>setter</code> or <code>getter</code>ï¼‰ã€‚</li>
<li>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡å­˜å‚¨æ–¹æ³•æˆ–å˜é‡åæ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>KVC</code>é—´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸”<code>KVC</code>è¿˜å¯ä»¥è®¿é—®ç§æœ‰å˜é‡ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œ<code>KVC</code>è¿˜å¯ä»¥å¸®åŠ©ç®€åŒ–ä»£ç </li>
<li><code>KVC</code>æ˜¯è®¸å¤šå…¶ä»–CocoaæŠ€æœ¯çš„åŸºç¡€ï¼Œæ¯”å¦‚<code>KVO</code>ã€<code>Cocoa bingdings</code>ï¼Œ<code>Core Data</code>ï¼Œ<code>AppleScript-ability</code>ç­‰ã€‚</li>
</ul>
<p>è®¿é—®å¯¹è±¡å±æ€§</p>
<h4 id="å¸¸ç”¨API"><a href="#å¸¸ç”¨API" class="headerlink" title="å¸¸ç”¨API"></a>å¸¸ç”¨API</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Return an array containing the results of invoking -valueForKey: on each of the receiver's elements. The returned array will contain NSNull elements for each instance of -valueForKey: returning nil.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">id</span>)valueForKey:(<span class="built_in">NSString</span> *)key;<span class="comment">// é€šè¿‡keyæ¥å–å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Invoke -setValue:forKey: on each of the receiver's elements.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Key-path-taking variants of like-named methods. The default implementation of each parses the key path enough to determine whether or not it has more than one component (key path components are separated by periods). If so, -valueForKey: is invoked with the first key path component as the argument, and the method being invoked is invoked recursively on the result, with the remainder of the key path passed as an argument. If not, the like-named non-key-path-taking method is invoked.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)valueForKeyPath:(<span class="built_in">NSString</span> *)keyPath; <span class="comment">// é€šè¿‡keyPathæ¥å–å€¼</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Given an array of keys, return a dictionary containing the keyed attribute values, to-one-related objects, and/or collections of to-many-related objects. Entries for which -valueForKey: returns nil have NSNull as their value in the returned dictionary.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)dictionaryWithValuesForKeys:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)keys;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Given a dictionary containing keyed attribute values, to-one-related objects, and/or collections of to-many-related objects, set the keyed values. Dictionary entries whose values are NSNull result in -setValue:nil forKey:key messages being sent to the receiver.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValuesForKeysWithDictionary:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)keyedValues;</span><br></pre></td></tr></table></figure>

<h5 id="setValue-forKey"><a href="#setValue-forKey" class="headerlink" title="setValue:forKey"></a>setValue:forKey</h5><p>é€šè¿‡<code>KVC</code>é—´æ¥ä¸ºå±æ€§èµ‹å€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[myAccount setValue:@(100.0) forKey:@&quot;currentBalance&quot;];</span><br></pre></td></tr></table></figure>

<h5 id="valueForKey"><a href="#valueForKey" class="headerlink" title="valueForKey"></a>valueForKey</h5><p>é€šè¿‡<code>KVC</code>é—´æ¥å–å€¼ï¼Œé€šè¿‡å…¶<code>key</code>è·å–å€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[myAccount valueForKey:@&quot;currentBalance&quot;];</span><br></pre></td></tr></table></figure>

<h5 id="setValue-forKeyPath"><a href="#setValue-forKeyPath" class="headerlink" title="setValue:forKeyPath"></a>setValue:forKeyPath</h5><p>KVC<code>è¿˜æ”¯æŒå¤šçº§è®¿é—®</code>ï¼ŒKeyPathç”¨æ³•å’Œç‚¹è¯­æ³•ç›¸åŒã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬æƒ³å¯¹<code>myAccount</code>çš„<code>owner</code>å±æ€§çš„<code>address</code>å±æ€§çš„<code>street</code>å±æ€§èµ‹å€¼ï¼Œå…¶<code>keyPath</code>ä¸º<code>myAccount.owner.address.</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[myAccount setValue:<span class="string">@"åœ°å€"</span> forKeyPath:<span class="string">@"owner.address.street"</span>];</span><br></pre></td></tr></table></figure>

<h4 id="å¤šå€¼æ“ä½œ"><a href="#å¤šå€¼æ“ä½œ" class="headerlink" title="å¤šå€¼æ“ä½œ"></a>å¤šå€¼æ“ä½œ</h4><p>ç»™å®šä¸€ç»„<code>Key</code>ï¼Œè·å¾—ä¸€ç»„<code>Value</code>ï¼Œä»¥å­—å…¸çš„å½¢å¼è¿”å›ã€‚è¯¥æ–¹æ³•ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ª<code>key</code>è°ƒç”¨<code>valueForKey</code>æ–¹æ³•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *, <span class="keyword">id</span>&gt; *)dictionaryWithValuesForKeys:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)keys;</span><br></pre></td></tr></table></figure>

<p>å°†æŒ‡å®šå­—å…¸ä¸­çš„å€¼è®¾ç½®åˆ°æ¶ˆæ¯æ¥å—è€…çš„å±æ€§ä¸­ï¼Œä½¿ç”¨å­—å…¸çš„keyæ ‡ç¤ºå±æ€§ã€‚é»˜è®¤å®ç°å¸‚å§”æ¯ä¸ªé”®å€¼è°ƒç”¨setValue:forKey:æ–¹æ³•ï¼Œä¼šæ ¹æ®éœ€è¦ç”¨nilæ›¿æ¢NSNullå¯¹è±¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setValuesForKeysWithDictionary:(NSDictionary&lt;NSString *, id&gt; *)keyedValues;</span><br></pre></td></tr></table></figure>

<h4 id="è®¿é—®é›†åˆå±æ€§"><a href="#è®¿é—®é›†åˆå±æ€§" class="headerlink" title="è®¿é—®é›†åˆå±æ€§"></a>è®¿é—®é›†åˆå±æ€§</h4><p>æˆ‘ä»¬å¯ä»¥åƒè®¿é—®å…¶ä»–å¯¹è±¡ä¸€æ ·ä½¿ç”¨<code>valueForKey:</code>æˆ–<code>setValue:forKey:</code>æ–¹æ³•è·å–æˆ–è®¾ç½®é›†åˆå¯¹è±¡ï¼ˆä¸»è¦åŒ…æ‹¬<code>NSArray</code>æˆ–<code>NSSet</code>ï¼‰ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬è¦æ“ä½œé›†åˆå¯¹è±¡çš„å†…å®¹ï¼Œæ¯”å¦‚æ·»åŠ æˆ–è€…åˆ é™¤å…ƒç´ æ—¶ï¼Œé€šè¿‡KVCçš„å¯å˜ä»£ç†æ–¹æ³•è·å–é›†åˆä»£ç†å¯¹è±¡æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æ ¹æ®<code>KVO</code>çš„å®ç°åŸç†ï¼Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆå­ç±»å¹¶é‡å†™<code>setter</code>æ–¹æ³•æ¥è¾¾åˆ°å¯ä»¥é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„ç›®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯¹é›†åˆå¯¹è±¡è¿›è¡Œæ“ä½œæ˜¯ä¸ä¼šè§¦å‘<code>KVO</code>çš„ã€‚å½“æˆ‘ä»¬è¦ä½¿ç”¨<code>KVO</code>ç›‘å¬é›†åˆå¯¹è±¡å˜åŒ–æ—¶ï¼Œéœ€è¦é€šè¿‡<code>KVC</code>çš„å¯å˜ä»£ç†æ–¹æ³•è·å–é›†åˆä»£ç†å¯¹è±¡ï¼Œç„¶åå¯¹ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå½“ä»£ç†å¯¹è±¡å†…éƒ¨å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘<code>KVO</code>çš„ç›‘å¬æ–¹æ³•ã€‚</p>
<p><code>KVC</code>æä¾›äº†ä¸‰ç§ä¸åŒçš„ä»£ç†å¯¹è±¡è®¿é—®çš„ä»£ç†æ–¹æ³•ï¼Œæ¯ç§éƒ½æœ‰<code>key</code> å’Œ <code>keyPath</code>ä¸¤ç§æ–¹æ³•ã€‚</p>
<ul>
<li><p>è¿”å›NSMutableArrayå¯¹è±¡çš„ä»£ç†å¯¹è±¡</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿”å›NSMutableSetå¯¹è±¡çš„ä»£ç†å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableSet *)mutableSetValueForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">- (NSMutableSet *)mutableSetValueForKeyPath:(NSString *)keyPath;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿”å›NSMutableOrderedSetå¯¹è±¡çš„ä»£ç†å¯¹è±¡</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableOrderedSet</span> *)mutableOrderedSetValueForKey:(<span class="built_in">NSString</span> *)key API_AVAILABLE(macos(<span class="number">10.7</span>), ios(<span class="number">5.0</span>), watchos(<span class="number">2.0</span>), tvos(<span class="number">9.0</span>));</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSMutableOrderedSet</span> *)mutableOrderedSetValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath API_AVAILABLE(macos(<span class="number">10.7</span>), ios(<span class="number">5.0</span>), watchos(<span class="number">2.0</span>), tvos(<span class="number">9.0</span>));</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="ä½¿ç”¨é›†åˆè¿ç®—ç¬¦"><a href="#ä½¿ç”¨é›†åˆè¿ç®—ç¬¦" class="headerlink" title="ä½¿ç”¨é›†åˆè¿ç®—ç¬¦"></a>ä½¿ç”¨é›†åˆè¿ç®—ç¬¦</h4><p>KVCçš„valueForKeyPath:æ–¹æ³•é™¤äº†å¯ä»¥å–å‡ºå±æ€§å€¼ä»¥å¤–ï¼Œè¿˜å¯ä»¥åœ¨keyPathä¸­åµŒå¥—é›†åˆè¿ç®—ç¬¦ï¼Œæ¥å¯¹é›†åˆå¯¹è±¡è¿›è¡Œæ“ä½œã€‚</p>
<p>KeyPath åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œleft key pathï¼ˆå·¦é”®è·¯å¾„ï¼‰ã€Collection operationï¼ˆé›†åˆè¿ç®—ç¬¦ï¼‰ã€right key pathï¼ˆå³é”®è·¯å¾„ï¼Œè¦è¿›è¡Œè¿ç®—çš„é›†åˆä¸­çš„å±æ€§ï¼‰</p>
<p>é›†åˆè¿ç®—ç¬¦åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>èšåˆè¿ç®—ç¬¦ï¼šä»¥æŸç§æ–¹å¼åˆå¹¶é›†åˆä¸­çš„å¯¹è±¡ï¼Œå¹¶è¿”å›å³é”®è·¯å¾„ä¸­æŒ‡å®šçš„å±æ€§çš„æ•°æ®ç±»å‹åŒ¹é…çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬è¿”å›NSNumberå¯¹è±¡</li>
<li>æ•°ç»„è¿ç®—ç¬¦ï¼šæ ¹æ®è¿ç®—ç¬¦çš„æ¡ä»¶ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ä»¥ä¸€ä¸ªNSArrayå¯¹è±¡è¿”å›</li>
<li>åµŒå¥—è¿ç®—ç¬¦ï¼šå¤„ç†é›†åˆå¯¹è±¡ä¸­åµŒå¥—å…¶ä»–é›†åˆå¯¹è±¡çš„æƒ…å†µï¼Œå¹¶æ ¹æ®è¿ç®—ç¬¦è¿”å›ä¸€ä¸ªNSArray æˆ– NSSetå¯¹è±¡</li>
</ul>
<h5 id="èšåˆè¿ç®—ç¬¦"><a href="#èšåˆè¿ç®—ç¬¦" class="headerlink" title="èšåˆè¿ç®—ç¬¦"></a>èšåˆè¿ç®—ç¬¦</h5><p>ä»¥æŸç§æ–¹å¼åˆå¹¶é›†åˆä¸­çš„å¯¹è±¡ï¼Œå¹¶è¿”å›å³é”®è·¯å¾„ä¸­æŒ‡å®šçš„å±æ€§çš„æ•°æ®ç±»å‹åŒ¹é…çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬è¿”å›NSNumberå¯¹è±¡</p>
<h6 id="avg"><a href="#avg" class="headerlink" title="@avg"></a>@avg</h6><p>è¯»å–é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œå°†å…¶è½¬æ¢ä¸ºdoubleç±»å‹ï¼ˆnil ç”¨ 0ä»£æ›¿ï¼‰ï¼Œå¹¶è®¡ç®—è¿™äº›å€¼çš„ç®—æœ¯å¹³å‡å€¼ï¼Œç„¶åå°†ç»“æœä»¥NSNumberå¯¹è±¡è¿”å›ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—é›†åˆä¸­amountå±æ€§çš„å¹³å‡å€¼</span></span><br><span class="line"><span class="built_in">NSNumber</span> *transactionAverage = [<span class="keyword">self</span>.transactions valueForKeyPath:<span class="string">@"@avg.amount"</span>];</span><br></pre></td></tr></table></figure>

<h6 id="count"><a href="#count" class="headerlink" title="@count"></a>@count</h6><p>è®¡ç®—é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œä»¥NSNumberå®ä¾‹è¿”å›</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®— transactions é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚</span></span><br><span class="line"><span class="built_in">NSNumber</span> *numberOfTransactions = [<span class="keyword">self</span>.transactions valueForKeyPath:<span class="string">@"@count"</span>];</span><br><span class="line"><span class="comment">// numberOfTransactions çš„å€¼ä¸º 13ã€‚</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤‡æ³¨ï¼š@countè¿ç®—ç¬¦æ¯”è¾ƒç‰¹åˆ«ï¼Œå®ƒä¸éœ€è¦å†™å³é”®è·¯å¾„ï¼Œå³ä½¿å†™äº†ä¹Ÿä¼šè¢«å¿½ç•¥</p>
</blockquote>
<h6 id="sum"><a href="#sum" class="headerlink" title="@sum"></a>@sum</h6><p>è¯»å–é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œå°†å…¶è½¬æ¢ä¸ºdoubleç±»å‹(nil ç”¨ 0ä»£æ›¿)ï¼Œå¹¶è®¡ç®—è¿™äº›å€¼çš„æ€»å’Œï¼Œç„¶åå°†ç»“æœä»¥NSNumberå®ä¾‹è¿”å›</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è®¡ç®—amount çš„æ€»å’Œ</span><br><span class="line">NSNumber *amountSum &#x3D; [self.transactions valueForKeyPath:@&quot;@sum.amount&quot;];</span><br></pre></td></tr></table></figure>

<h6 id="max"><a href="#max" class="headerlink" title="@max"></a>@max</h6><p>è¿”å›é›†åˆå³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§çš„æœ€å¤§å€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è·å–æ—¥æœŸçš„æœ€å¤§å€¼</span><br><span class="line">NSDate *latestDate &#x3D; [self.transactions valueForKeyPath:@&quot;@max.date&quot;];</span><br></pre></td></tr></table></figure>

<p>@min</p>
<p>è¿”å›é›†åˆå³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§çš„æœ€å°å€¼</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æ—¥æœŸçš„æœ€å°å€¼</span></span><br><span class="line"><span class="built_in">NSDate</span> *earliestDate = [<span class="keyword">self</span>.transactions valueForKeyPath:<span class="string">@"@min.date"</span>];</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤‡æ³¨ï¼š@max å’Œ @minæ ¹æ®å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§åœ¨é›†åˆä¸­æœç´¢ï¼Œæœç´¢ä½¿ç”¨compare:æ–¹æ³•è¿›è¡Œã€‚å› æ­¤ï¼Œå³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§å¿…é¡»èƒ½å“åº”compare:æ¶ˆæ¯ã€‚æœç´¢å¿½ç•¥å€¼ä¸ºnilçš„é›†åˆé¡¹ï¼Œä¹Ÿå¯é€šè¿‡é‡å†™compare:æ–¹æ³•å¯¹æœç´¢ç»“æœè¿›è¡Œæ§åˆ¶ã€‚</p>
</blockquote>
<h5 id="æ•°ç»„è¿ç®—ç¬¦"><a href="#æ•°ç»„è¿ç®—ç¬¦" class="headerlink" title="æ•°ç»„è¿ç®—ç¬¦"></a>æ•°ç»„è¿ç®—ç¬¦</h5><p>æ ¹æ®è¿ç®—ç¬¦çš„æ¡ä»¶ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å¯¹è±¡ä»¥ä¸€ä¸ªNSArrayå®ä¾‹è¿”å›ã€‚</p>
<h6 id="unionOfObjects"><a href="#unionOfObjects" class="headerlink" title="@unionOfObjects"></a>@unionOfObjects</h6><p>è¯»å–æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œæ”¾åœ¨ä¸€ä¸ªNSArrayå®ä¾‹ä¸­è¿”å›</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è·å–é›†åˆä¸­çš„æ‰€æœ‰payeeå¯¹è±¡</span><br><span class="line">NSArray *payees &#x3D; [self.transactions valueForKeyPath:@&quot;@unionOfObjects.payee&quot;];</span><br><span class="line">&#x2F;&#x2F; payees æ•°ç»„ä¸­åŒ…å«æ‰€æœ‰payeeå…ƒç´ çš„å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure>

<h6 id="distinctUnionOfObjects"><a href="#distinctUnionOfObjects" class="headerlink" title="@distinctUnionOfObjects"></a>@distinctUnionOfObjects</h6><p>è¯»å–æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œæ”¾åœ¨ä¸€ä¸ªNSArrayå®ä¾‹ä¸­ï¼Œå°†æ•°ç»„è¿›è¡Œå»é‡åè¿”å›ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è·å–é›†åˆä¸­çš„æ‰€æœ‰ä¸åŒçš„ payee å¯¹è±¡ã€‚</span><br><span class="line">NSArray *distinctPayees &#x3D; [self.transactions valueForKeyPath:@&quot;@distinctUnionOfObjects.payee&quot;];</span><br><span class="line">&#x2F;&#x2F; distinctPayees æ•°ç»„åŒ…å«ä»¥ä¸‹å­—ç¬¦ä¸²ï¼šCar Loan, General Cable, Animal Hospital, Green Power, Mortgage</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨æ•°ç»„è¿ç®—ç¬¦æ—¶ï¼Œå¦‚æœæœ‰ä»»ä½•æ“ä½œçš„å¯¹è±¡ä¸ºnilï¼Œåˆ™valueForKeyPath:æ–¹æ³•å°†å¼•å‘å¼‚å¸¸</p>
</blockquote>
<h5 id="åµŒå¥—è¿ç®—ç¬¦"><a href="#åµŒå¥—è¿ç®—ç¬¦" class="headerlink" title="åµŒå¥—è¿ç®—ç¬¦"></a>åµŒå¥—è¿ç®—ç¬¦</h5><p>å¤„ç†é›†åˆå¯¹è±¡ä¸­åµŒå¥—å…¶ä»–é›†åˆå¯¹è±¡çš„æƒ…å†µï¼Œå¹¶æ ¹æ®è¿ç®—ç¬¦è¿”å›ä¸€ä¸ªNSArray å’Œ NSSetå®ä¾‹ã€‚</p>
<p>å¦‚ä¸‹ï¼Œä¸€ä¸ªæ•°ç»„ä¸­æ”¾ç€å¦å¤–ä¸¤ä¸ªæ•°ç»„</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span>* moreTransactions = @[&lt;<span class="meta"># transaction data #&gt;];</span></span><br><span class="line"><span class="built_in">NSArray</span>* arrayOfArrays = @[<span class="keyword">self</span>.transactions, moreTransactions];</span><br></pre></td></tr></table></figure>

<h6 id="unionOfArrays"><a href="#unionOfArrays" class="headerlink" title="@unionOfArrays"></a>@unionOfArrays</h6><p>è¯»å–é›†åˆä¸­æ¯ä¸ªé›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œæ”¾åœ¨ä¸€ä¸ªNSArrayå®ä¾‹ä¸­è¿”å›ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– arrayOfArrays é›†åˆä¸­çš„æ¯ä¸ªé›†åˆä¸­çš„æ‰€æœ‰ payee å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="built_in">NSArray</span> *collectedPayees = [arrayOfArrays valueForKeyPath:<span class="string">@"@unionOfArrays.payee"</span>];</span><br></pre></td></tr></table></figure>

<h6 id="distinctUnionOfArrays"><a href="#distinctUnionOfArrays" class="headerlink" title="@distinctUnionOfArrays"></a>@distinctUnionOfArrays</h6><p>è¯»å–é›†åˆä¸­æ¯ä¸ªé›†åˆæ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œæ”¾åœ¨ä¸€ä¸ªNSArrayå®ä¾‹ä¸­ï¼Œå°†æ•°ç»„è¿›è¡Œå»é‡åè¿”å›ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– arrayOfArrays é›†åˆä¸­çš„æ¯ä¸ªé›†åˆä¸­çš„æ‰€æœ‰ä¸åŒçš„ payee å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="built_in">NSArray</span> *collectedDistinctPayees = [arrayOfArrays valueForKeyPath:<span class="string">@"@distinctUnionOfArrays.payee"</span>];</span><br></pre></td></tr></table></figure>

<h6 id="distinctUnionOfSets"><a href="#distinctUnionOfSets" class="headerlink" title="@distinctUnionOfSets"></a>@distinctUnionOfSets</h6><p>è¯»å–é›†åˆä¸­æ¯ä¸ªé›†åˆæ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ï¼Œæ”¾åœ¨ä¸€ä¸ªNSSetå®ä¾‹ä¸­ï¼Œå»é‡åè¿”å›ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSSet</span> *collectedDistinctPayees = [setOfSets valueForKeyPath:<span class="string">@"@distinctUnionOfSets.payee"</span>];</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>åœ¨ä½¿ç”¨åµŒå¥—è¿ç®—ç¬¦æ—¶ï¼ŒvalueForKeyPath:å†…éƒ¨ä¼šæ ¹æ®è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªNSMuatbleArray æˆ– NSMuatbleSetå¯¹è±¡ï¼Œå°†é›†åˆä¸­çš„array å’Œ setæ·»åŠ è¿›å»åœ¨è¿›è¡Œæ“ä½œã€‚å¦‚æœé›†åˆä¸­æœ‰éé›†åˆå…ƒç´ ï¼Œä¼šå¯¼è‡´Crash</li>
<li>ä½¿ç”¨unionArrays æˆ– distionctUnionOfArraysè¿ç®—ç¬¦ï¼Œæ¶ˆæ¯æ¥æ”¶è€…åº”è¯¥æ˜¯arrayOfArraysç±»å‹ï¼Œå³<code>NSArray&lt;NASrray *&gt; *arrayOfArrays;</code>ï¼›ä½¿ç”¨distinctUnionOfSetsè¿ç®—ç¬¦ï¼Œæ¶ˆæ¯æ¥æ”¶è€…çš„ç±»å‹åº”è¯¥æ˜¯setOfSetsæˆ–è€…arrayOfSetsç±»å‹ï¼Œå¦åˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</li>
<li>åœ¨ä½¿ç”¨åµŒå¥—è¿ç®—ç¬¦æ—¶ï¼Œå¦‚æœæœ‰ä»»ä½•æ“ä½œå¯¹è±¡ä¸ºnilï¼Œåˆ™valueForKeyPath:æ–¹æ³•å°†å¼•å‘å¼‚å¸¸</li>
</ul>
</blockquote>
<h5 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h5><p>å¦‚æœé›†åˆå¯¹è±¡éƒ½æ˜¯NSNumberï¼Œå³é”®è·¯å¾„å¯ä»¥ç”¨self</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSArray *array &#x3D; @[@1, @2, @3, @4, @5];</span><br><span class="line">NSNumber *sum &#x3D; [array valueForKeyPath:@&quot;@sum.self&quot;];</span><br><span class="line">NSLog(@&quot;%d&quot;,[sum intValue]);</span><br></pre></td></tr></table></figure>

<h4 id="è‡ªå®šä¹‰é›†åˆè¿ç®—ç¬¦"><a href="#è‡ªå®šä¹‰é›†åˆè¿ç®—ç¬¦" class="headerlink" title="è‡ªå®šä¹‰é›†åˆè¿ç®—ç¬¦"></a>è‡ªå®šä¹‰é›†åˆè¿ç®—ç¬¦</h4><p>æ ¹æ®<code>Runtime</code>è·å–<code>NSArray</code>ç±»çš„æ–¹æ³•åˆ—è¡¨</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)print_arrayMethodList &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">    Method *methods = class_copyMethodList([<span class="built_in">NSArray</span> <span class="keyword">class</span>], &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; count; i++) &#123;</span><br><span class="line">        Method method = methods[i];</span><br><span class="line">        SEL sel = method_getName(method);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,<span class="built_in">NSStringFromSelector</span>(sel));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœ(æœªå®Œå…¨æˆªå›¾)ï¼š</p>
<p><img src="/Users/mikasa/Desktop/image_mark/image-20201208151209139.png" alt="image-20201208151209139"></p>
<p>æ–¹æ³•å¾ˆå¤šï¼Œæœç´¢å…³é”®å­—<code>avg</code>ã€<code>count</code>ã€<code>sum</code>ç­‰<code>KVC</code>ä¸ºæˆ‘ä»¬æä¾›çš„é›†åˆè¿ç®—ç¬¦ï¼Œå‘ç°éƒ½æœ‰å¯¹è±¡çš„æ–¹æ³•<code>_&lt;operatorKey&gt;ForKeyPath:</code></p>
<blockquote>
<p>æ³¨æ„ï¼šå†æ¥çœ‹ä¸€ä¸‹<code>NSSet</code>ç±»æ”¯æŒçš„é›†åˆè¿ç®—ç¬¦ï¼š</p>
<p>å¯è§<code>NSSet</code>ç±»ä¸æ”¯æŒ<code>@unionOfObjects</code> å’Œ <code>@unionOfArrays</code>è¿ç®—ç¬¦ï¼Œå¦‚æœä½¿ç”¨äº†å°±ä¼šæŠ›å‡º<code>NSInvalidArgumentException</code>å¼‚å¸¸å¹¶å´©æºƒï¼Œreasonï¼š<code>[&lt;__NSSetI 0x6000017a12f0&gt; valueForKeyPath:]: this class does not implement the unionOfArrays operation.</code>ä¸æ”¯æŒè¯¥è¿ç®—ç¬¦ã€‚</p>
<p>è€Œ<code>NSArray</code>ç±»è™½ç„¶æ”¯æŒ<code>@distinctUnionOfSets</code>è¿ç®—ç¬¦ï¼Œä½†æ˜¯å¿…é¡»æ˜¯<code>arrayOfSets</code>ç±»å‹ï¼Œå³<code>NSArray&lt; NSSet* &gt;* arrayOfSets;</code>ï¼Œå› ä¸º<code>_distinctUnionOfSetsForKeyPath</code>æ–¹æ³•ä¸­ä¼šåˆ›å»ºä¸€ä¸ª<code>NSMutableSet</code>å®ä¾‹ï¼Œå¹¶è°ƒç”¨<code>unionSet:</code>æ–¹æ³•å°†é›†åˆä¸­çš„setå…ƒç´ æ·»åŠ è¿›å»å†è¿›è¡Œæ“ä½œï¼Œå¦‚æœæ˜¯<code>arrayOfArrays</code>ç±»å‹å°±ä¼šæŠ›å‡º<code>NSInvalidArgumentException</code>å¹¶å¯¼è‡´ç¨‹åºå´©æºƒï¼Œreason: <code>&#39;*** -[NSMutableSet unionSet:]: set argument is not an NSSet&#39;</code>å³é›†åˆä¸­æœ‰é<code>NSSet</code>å…ƒç´ ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å°è¯•ä¸ºNSArrayæ·»åŠ ä¸€ä¸ªåˆ†ç±»ï¼Œå¹¶å®šä¹‰ä¸€ä¸ª_medianForKeyPath:æ–¹æ³•ï¼Œç”¨æ¥è·å–NSArrayä¸­çš„ä¸­ä½æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@interface NSArray (kvc)</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation NSArray (kvc)</span><br><span class="line">- (NSNumber *)_medianForKeyPath:(NSString *)keyPath &#123;</span><br><span class="line">    &#x2F;&#x2F;æ’åº</span><br><span class="line">    NSArray *sortedArray &#x3D; [self sortedArrayUsingSelector:@selector(compare:)];</span><br><span class="line">    double median;</span><br><span class="line">    if (self.count % 2 &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        NSInteger index1 &#x3D; sortedArray.count * 0.5;</span><br><span class="line">        NSInteger index2 &#x3D; sortedArray.count * 0.5 - 1;</span><br><span class="line">        median &#x3D; ([[sortedArray objectAtIndex:index1] doubleValue] + [[sortedArray objectAtIndex:index2] doubleValue]) * 0.5;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        NSInteger index &#x3D; (sortedArray.count-1) * 0.5;</span><br><span class="line">        median &#x3D; [[sortedArray objectAtIndex:index] doubleValue];</span><br><span class="line">    &#125;</span><br><span class="line">    return [NSNumber numberWithDouble:median];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)medianObject_kvc &#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *arr = @[@<span class="number">3</span>,@<span class="number">4</span>,@<span class="number">8</span>,@<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">NSNumber</span> *num = [arr valueForKeyPath:<span class="string">@"@median.self"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,num);</span><br><span class="line">&#125;</span><br><span class="line">[<span class="number">15</span>:<span class="number">55</span>:<span class="number">06</span>] +[MMKVC medianObject_kvc] [ç¬¬<span class="number">67</span>è¡Œ] ğŸ’• <span class="number">3.5</span></span><br></pre></td></tr></table></figure>

<h4 id="éå¯¹è±¡å€¼å¤„ç†"><a href="#éå¯¹è±¡å€¼å¤„ç†" class="headerlink" title="éå¯¹è±¡å€¼å¤„ç†"></a>éå¯¹è±¡å€¼å¤„ç†</h4><p><code>KVC</code>æ”¯æŒåŸºç¡€æ•°æ®ç±»å‹å’Œç»“æ„ä½“ï¼Œåœ¨ä½¿ç”¨<code>KVC</code>èµ‹å€¼æˆ–å–å€¼çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åœ¨éå¯¹è±¡å€¼å’Œå¯¹è±¡å€¼ä¹‹é—´è½¬æ¢</p>
<ul>
<li>å½“è¿›è¡Œå–å€¼å¦‚<code>valueForKey:</code>æ—¶ï¼Œå¦‚æœè¿”å›å€¼éå¯¹è±¡ï¼Œä¼šä½¿ç”¨è¯¥å€¼åˆå§‹åŒ–ä¸€ä¸ª<code>NSNumber</code>æˆ– <code>NSValue</code>å®ä¾‹ï¼Œç„¶åè¿”å›è¯¥å®ä¾‹ã€‚</li>
<li>å½“è¿›è¡Œèµ‹å€¼å¦‚<code>setValue:forKey:</code>æ—¶ï¼Œå¦‚æœkeyçš„æ•°æ®ç±»å‹éå¯¹è±¡ï¼Œåˆ™ä¼šå‘é€ä¸€æ¡<code>&lt;type&gt;Value</code>æ¶ˆæ¯ç»™valueå¯¹è±¡ä»¥æå–åŸºç¡€æ•°æ®ï¼Œç„¶åå¤åˆ¶ç»™<code>key</code></li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>å› ä¸ºswiftä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œä»…é€‚ç”¨äºObjective-Cå±æ€§ã€‚å½“è¿›è¡Œèµ‹å€¼å¦‚setValue:forKeyæ—¶ï¼Œå¦‚æœkey çš„æ•°æ®ç±»æ˜¯éå¯¹è±¡ç±»å‹ï¼Œåˆ™valueå°±ç¦æ­¢ä¼ nilã€‚å¦åˆ™è°ƒç”¨setNilValueForKey:æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„é»˜è®¤å®ç°æŠ›å‡ºå¼‚å¸¸NSInvalidArgumentExceptionï¼Œå¹¶å¯¼è‡´Crash</li>
</ul>
</blockquote>
<h4 id="å±æ€§éªŒè¯"><a href="#å±æ€§éªŒè¯" class="headerlink" title="å±æ€§éªŒè¯"></a>å±æ€§éªŒè¯</h4><p><code>KVC</code>æä¾›äº†å±æ€§éªŒè¯çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨<code>KVC</code>èµ‹å€¼å‰éªŒè¯èƒ½å¦ä¸ºè¿™ä¸ª<code>key</code>èµ‹å€¼æŒ‡å®šçš„<code>value</code>ã€‚</p>
<p><code>validateValue</code>æ–¹æ³•çš„é»˜è®¤å®ç°æ˜¯æŸ¥çœ‹æ¶ˆæ¯æ¥æ”¶è€…ç±»ä¸­æ˜¯å¦å®ç°äº†éµå¾ªå‘½åè§„åˆ™ä¸º<code>validate&lt;key&gt;:error:</code>çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰å°±è¿”å›è°ƒç”¨è¯¥æ–¹æ³•çš„ç»“æœï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±é»˜è®¤éªŒè¯æˆåŠŸå¹¶è¿”å›YESï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯æ¥æ”¶è€…ç±»ä¸­å®ç°<code>validate&lt;key&gt;:error:</code>æ–¹æ³•æ¥å®šä¹‰é€»è¾‘è¿”å›YES æˆ– NO</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)validateValue:(<span class="keyword">inout</span> <span class="keyword">id</span> _Nullable * _Nonnull)ioValue forKeyPath:(<span class="built_in">NSString</span> *)inKeyPath error:(<span class="keyword">out</span> <span class="built_in">NSError</span> **)outError;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)validateValue:(<span class="keyword">inout</span> <span class="keyword">id</span> _Nullable * _Nonnull)ioValue forKey:(<span class="built_in">NSString</span> *)inKey error:(<span class="keyword">out</span> <span class="built_in">NSError</span> **)outError;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹</p>
<p>åœ¨Personç±»ä¸­å®ç°äº†validateName:error:æ–¹æ³•ï¼ŒéªŒè¯ç»™nameèµ‹çš„å€¼æ˜¯ä¸æ˜¯Jackã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ViewController.m</span></span><br><span class="line">    Person *person = [[Person alloc] init];</span><br><span class="line">    <span class="built_in">NSString</span> *value = <span class="string">@"rose"</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *key = <span class="string">@"name"</span>;</span><br><span class="line">    <span class="built_in">NSError</span>  *error;</span><br><span class="line">    <span class="built_in">BOOL</span> result = [person validateValue:&amp;value forKey:key error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"error = %@"</span>, error);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%d"</span>,result);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Person.m</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)validateName:(<span class="keyword">id</span> *)value error:(<span class="keyword">out</span> <span class="built_in">NSError</span> * _Nullable __autoreleasing *)outError</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *name = *value;</span><br><span class="line">    <span class="built_in">BOOL</span> result = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">if</span> ([name isEqualToString:<span class="string">@"jack"</span>]) &#123;</span><br><span class="line">        result = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å°ï¼š0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤‡æ³¨ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒKVCæ˜¯ä¸ä¼šè‡ªåŠ¨éªŒè¯å±æ€§çš„ã€‚</p>
</blockquote>
<h4 id="æœç´¢è§„åˆ™"><a href="#æœç´¢è§„åˆ™" class="headerlink" title="æœç´¢è§„åˆ™"></a>æœç´¢è§„åˆ™</h4><h5 id="åŸºæœ¬çš„getteræœç´¢æ¨¡å¼"><a href="#åŸºæœ¬çš„getteræœç´¢æ¨¡å¼" class="headerlink" title="åŸºæœ¬çš„getteræœç´¢æ¨¡å¼"></a>åŸºæœ¬çš„getteræœç´¢æ¨¡å¼</h5><p>ä»¥ä¸‹æ˜¯valueForKey:æ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œç»™å®šä¸€ä¸ªkeyä½œä¸ºè¾“å…¥å‚æ•°ï¼Œåœ¨æ¶ˆæ¯æ¥æ”¶è€…ç±»ä¸­æ“ä½œï¼Œæ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ã€‚</p>
<ol>
<li>æŒ‰ç…§<code>get&lt;key&gt;</code>ã€<code>&lt;key&gt;</code>ã€<code>is&lt;key&gt;</code>ã€<code>_&lt;key&gt;</code>é¡ºåºæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°å°±è°ƒç”¨å–å€¼ç›´æ¥æ‰§è¡Œ5ï¼Œå¦åˆ™æ‰§è¡Œ2</li>
<li>æŸ¥æ‰¾countOf<key>ã€objectIn<key>AtIndex:ã€<key>AtIndexes:å‘½åçš„æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°ç¬¬ä¸€ä¸ªå’Œåé¢ä¸¤ä¸ªä¸­çš„è‡³å°‘ä¸€ä¸ªï¼Œåˆ™åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå“åº”æ‰€æœ‰NSArrayçš„æ–¹æ³•çš„é›†åˆä»£ç†å¯¹è±¡ï¼ˆç±»å‹ä¸ºNSKeyValueArrayï¼Œç»§æ‰¿NSArrayï¼‰ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚å¦åˆ™æ‰§è¡Œ3<ul>
<li>ä»£ç†å¯¹è±¡éšåå°†å°†å…¶æ¥æ”¶åˆ°çš„ä»»ä½•NSArrayæ¶ˆæ¯è½¬æ¢ä¸ºcountOf<key>ã€objetIn<key>AtIndex:ã€<key>AtIndexes:æ¶ˆæ¯çš„ç»„åˆï¼Œå¹¶å°†å…¶å‘é€ç»™KVCè°ƒç”¨æ–¹ã€‚å¦‚æœåŸå§‹å¯¹è±¡è¿˜å®ç°äº†ä¸€ä¸ªåä¸ºget<key>:range:çš„å¯é€‰æ–¹æ³•ï¼Œåˆ™ä»£ç†å¯¹è±¡ä¹Ÿä¼šåœ¨é€‚å½“æ—¶ä½¿ç”¨è¯¥æ–¹æ³•</li>
<li>å½“KVCè°ƒç”¨æ–¹ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å·¥ä½œæ—¶ï¼Œå…è®¸åº•å±‚å±æ€§çš„è¡Œä¸ºå¦‚æœNSArrayä¸€æ ·ï¼Œå³ä½¿å®ƒä¸æ˜¯NSArray</li>
</ul>
</li>
<li>æŸ¥æ‰¾<code>countOf&lt;key&gt;</code>ã€<code>enumeratorOf&lt;key&gt;</code>ã€<code>memberOf&lt;key&gt;:</code>å‘½åçš„æ–¹æ³•ï¼Œå¦‚æœä¸‰ä¸ªæ–¹æ³•éƒ½æ‰¾åˆ°ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå“åº”æ‰€æœ‰NSSetçš„æ–¹æ³•çš„é›†åˆä»£ç†å¯¹è±¡ï¼ˆç±»å‹ä¸ºNSKeyValueSetï¼Œç»§æ‰¿è‡ªNSSetï¼‰ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚å¦åˆ™æ‰§è¡Œ4<ul>
<li>ä»£ç†å¯¹è±¡éšåå°†å…¶æ¥æ”¶åˆ°çš„ä»»ä½•NSSetæ¶ˆæ¯è½¬æ¢ä¸º<code>countOf&lt;key&gt;</code>ã€<code>enumeratorOf&lt;key&gt;</code>ã€<code>memberOf&lt;key&gt;:</code>æ¶ˆæ¯çš„ç»„åˆï¼Œå¹¶å°†å…¶å‘é€ç»™KVCçš„è°ƒç”¨æ–¹</li>
<li>å½“KVCè°ƒç”¨æ–¹ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å·¥ä½œæ—¶ï¼Œå…è®¸åº•å±‚å±æ€§çš„è¡Œä¸ºå¦‚åŒNSSetä¸€æ ·ï¼Œå³ä½¿ä»–ä¸æ˜¯NSSetã€‚</li>
</ul>
</li>
<li>æŸ¥çœ‹æ¶ˆæ¯æ¥æ”¶è€…ç±»çš„<code>+accessInstanceVariableDirectly</code>æ–¹æ³•çš„è¿”å›å€¼ï¼ˆé»˜è®¤è¿”å›YESï¼‰ï¼Œå¦‚æœè¿”å›YESï¼Œå°±æŒ‰ç…§<code>_&lt;key&gt;</code>ã€<code>_is&lt;key&gt;</code>ã€<code>&lt;key&gt;</code>ã€<code>is&lt;key&gt;</code>é¡ºåºæŸ¥æ‰¾æˆå‘˜å˜é‡ã€‚å¦‚æœæ‰¾åˆ°å°±ç›´æ¥å–å€¼æ‰§è¡Œ5ï¼Œå¦åˆ™æ‰§è¡Œ6ã€‚å¦‚æœ<code>+accessInstanceVariableDirectly</code>æ–¹æ³•è¿”å›NOï¼Œ ä¹Ÿä¼šæ‰§è¡Œ6</li>
<li>å¦‚æœå–åˆ°å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡æŒ‡é’ˆï¼Œå³è·å–çš„æ˜¯å¯¹è±¡ï¼Œåˆ™ç›´æ¥å°†å¯¹è±¡è¿”å›ã€‚å¦‚æœå–å¾—å€¼æ˜¯ä¸€ä¸ªNSNumberæ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œåˆ™è½¬æ¢ä¸ºNSValueå¯¹è±¡ï¼Œç„¶åè¿”å›ã€‚</li>
<li>è°ƒç”¨valueForUndefinedKey:æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŠ›å‡ºå¼‚å¸¸NSUnknownKeyExceptionï¼Œå¹¶å¯¼è‡´ç¨‹åºCrashï¼Œè¿™æ˜¯é»˜è®¤å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¯¥æ–¹æ³•æ ¹æ®ç‰¹ç‚¹çš„keyåšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚</li>
</ol>
<h5 id="åŸºæœ¬çš„Setteræœç´¢æ¨¡å¼"><a href="#åŸºæœ¬çš„Setteræœç´¢æ¨¡å¼" class="headerlink" title="åŸºæœ¬çš„Setteræœç´¢æ¨¡å¼"></a>åŸºæœ¬çš„Setteræœç´¢æ¨¡å¼</h5><p>ä»¥ä¸‹æ˜¯setValue:forKeyæ–¹æ³•çš„é»˜è®¤å®ç°ï¼Œç»™å®šä¸€ä¸ªkeyä½œä¸ºè¾“å…¥å‚æ•°ï¼Œè¿”å›å±æ€§åä¸ºkeyçš„é›†åˆçš„ä»£ç†å¯¹è±¡ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯NSMutableArrayå¯¹è±¡ï¼‰ï¼Œåœ¨æ¶ˆæ¯æ¥æ”¶è€…ç±»ä¸­æ“ä½œï¼Œæ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ã€‚</p>
<ol>
<li><p>æŸ¥æ‰¾â€”å¯¹æ–¹æ³•<code>insert&lt;Key&gt;:atIndexes:</code>å’Œ<code>remove&lt;Key&gt;AtIndexes:</code><br>ï¼ˆç›¸å½“äº<code>NSMutableArray</code>çš„åŸå§‹æ–¹æ³•<code>insertObjects:atIndexes:</code>å’Œ<code>removeObjectsAtIndexes:</code>ï¼‰ã€‚</p>
<ul>
<li><p>å¦‚æœæˆ‘ä»¬è‡³å°‘å®ç°äº†ä¸€ä¸ª<code>insertion</code>æ–¹æ³•å’Œä¸€ä¸ª<code>removal</code>æ–¹æ³•ï¼Œåˆ™è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œæ¥å“åº”å‘é€ç»™<code>NSMutableArray</code>çš„æ¶ˆæ¯ï¼Œé€šè¿‡å‘é€<code>insertObject:in&lt;Key&gt;AtIndex:</code>ã€<code>removeObjectFrom&lt;Key&gt;AtIndex:</code>ã€<code>insert&lt;Key&gt;:atIndexes:</code>ã€<code>remove&lt;Key&gt;AtIndexes:</code>ç»„åˆæ¶ˆæ¯ç»™<code>KVC</code>è°ƒç”¨æ–¹ã€‚å¦åˆ™æ‰§è¡Œâ‘¡ã€‚</p>
<blockquote>
<p>è¯¥ä»£ç†å¯¹è±¡ç±»å‹ä¸º<code>NSKeyValueFastMutableArray2</code>ï¼Œç»§æ‰¿é“¾ä¸º<code>NSKeyValueFastMutableArray2</code>-&gt;<code>NSKeyValueFastMutableArray</code>-&gt;<code>NSKeyValueMutableArray</code>-&gt;<code>NSMutableArray</code>ã€‚</p>
</blockquote>
</li>
<li><p>å¦‚æœæˆ‘ä»¬ä¹Ÿå®ç°äº†ä¸€ä¸ªå¯é€‰çš„<code>replace object</code>æ–¹æ³•ï¼Œå¦‚<code>replaceObjectIn&lt;Key&gt;AtIndex:withObject:</code>æˆ–<code>replace&lt;Key&gt;AtIndexes:with&lt;Key&gt;:</code>ï¼Œä»£ç†å¯¹è±¡åœ¨é€‚å½“çš„æƒ…å†µä¸‹ä¹Ÿä¼šä½¿ç”¨å®ƒä»¬ï¼Œä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚</p>
</li>
</ul>
</li>
<li><p>æŸ¥æ‰¾<code>set&lt;Key&gt;:</code>æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°ï¼Œå°±ä¼šå‘<code>KVC</code>è°ƒç”¨æ–¹å‘é€ä¸€ä¸ª<code>set&lt;Key&gt;:</code></p>
<p>æ¶ˆæ¯ï¼Œæ¥è¿”å›ä¸€ä¸ªå“åº”<code>NSMutableArray</code>æ¶ˆæ¯çš„ä»£ç†å¯¹è±¡ã€‚å¦åˆ™æ‰§è¡Œâ‘¢ã€‚</p>
<blockquote>
<p>è¯¥ä»£ç†å¯¹è±¡ç±»å‹ä¸º<code>NSKeyValueSlowMutableArray</code>ï¼Œç»§æ‰¿é“¾ä¸º<code>NSKeyValueSlowMutableArray</code>-&gt;<code>NSKeyValueMutableArray</code>-&gt;<code>NSMutableArray</code>ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼š** æ­¤æ­¥éª¤ä¸­æè¿°çš„æœºåˆ¶æ¯”ä¸Šä¸€æ­¥çš„æ•ˆç‡ä½å¾—å¤šï¼Œå› ä¸ºå®ƒå¯èƒ½é‡å¤åˆ›å»ºæ–°çš„é›†åˆå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„é›†åˆå¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡è‡ªå·±çš„é”®å€¼ç¼–ç å…¼å®¹å¯¹è±¡æ—¶ï¼Œé€šå¸¸åº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚</p>
<p>ç»™ä»£ç†å¯¹è±¡å‘é€<code>NSMutableArray</code>æ¶ˆæ¯éƒ½ä¼šè°ƒç”¨<code>set&lt;Key&gt;:</code>æ–¹æ³•ã€‚å³ï¼Œå¯¹ä»£ç†å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œéƒ½æ˜¯è°ƒç”¨<code>set&lt;Key&gt;:</code>æ¥é‡æ–°èµ‹å€¼ï¼Œæ‰€ä»¥æ•ˆç‡ä¼šä½å¾ˆå¤šã€‚</p>
</blockquote>
</li>
<li><p>æŸ¥çœ‹æ¶ˆæ¯æ¥æ”¶è€…ç±»çš„<code>+accessInstanceVariablesDirectly</code>æ–¹æ³•çš„è¿”å›å€¼ï¼ˆé»˜è®¤è¿”å›<code>YES</code>ï¼‰ã€‚å¦‚æœè¿”å›<code>YES</code>ï¼Œå°±æŒ‰ç…§<code>_&lt;key&gt;</code>ã€<code>&lt;key&gt;</code>é¡ºåºæŸ¥æ‰¾æˆå‘˜å˜é‡ã€‚å¦‚æœæ‰¾åˆ°å°±è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡å°†æ¥æ”¶æ‰€æœ‰<code>NSMutableArray</code>æ¶ˆæ¯ï¼Œé€šå¸¸æ˜¯<code>NSMutableArray</code>æˆ–å…¶å­ç±»ã€‚å¦åˆ™æ‰§è¡Œâ‘£ã€‚å¦‚æœ<code>+accessInstanceVariablesDirectly</code>æ–¹æ³•è¿”å›<code>NO</code>ä¹Ÿæ‰§è¡Œâ‘£ã€‚</p>
</li>
<li><p>è¿”å›ä¸€ä¸ªå¯å˜çš„é›†åˆä»£ç†å¯¹è±¡ã€‚å½“å®ƒæ¥æ”¶åˆ°<code>NSMutableArray</code>æ¶ˆæ¯æ—¶ï¼Œå‘é€ä¸€ä¸ª<code>valueForUndefinedKey:</code>æ¶ˆæ¯ç»™<code>KVC</code>è°ƒç”¨æ–¹ï¼Œè¯¥æ–¹æ³•æŠ›å‡ºå¼‚å¸¸<code>NSUnknownKeyException</code>ï¼Œå¹¶å¯¼è‡´ç¨‹åº<code>Crash</code>ã€‚è¿™æ˜¯é»˜è®¤å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¯¥æ–¹æ³•æ ¹æ®ç‰¹å®š<code>key</code>åšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚</p>
</li>
</ol>
<h5 id="å…¶ä»–æœç´¢æ¨¡å¼"><a href="#å…¶ä»–æœç´¢æ¨¡å¼" class="headerlink" title="å…¶ä»–æœç´¢æ¨¡å¼"></a>å…¶ä»–æœç´¢æ¨¡å¼</h5><p>é™¤äº†ä»¥ä¸Šä¸‰ç§ï¼Œ<code>KVC</code>è¿˜æœ‰<code>NSMutableSet</code>å’Œ<code>NSMutableOrderedSet</code>ä¸¤ç§æœç´¢æ¨¡å¼ï¼Œå®ƒä»¬çš„æœç´¢è§„åˆ™å’Œ<code>NSMutableArray</code>ç›¸åŒï¼Œåªæ˜¯æœç´¢å’Œè°ƒç”¨çš„æ–¹æ³•ä¸åŒã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹<code>KVC</code>å®˜æ–¹æ–‡æ¡£ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueCoding/SearchImplementation.html#//apple_ref/doc/uid/20000955-CJBBBFFA" target="_blank" rel="noopener">KVC - Accessor Search Patterns</a></p>
<h4 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h4><ul>
<li><p>æ ¹æ®KVCæœç´¢è§„åˆ™ï¼Œå½“æ²¡æœ‰æœç´¢åˆ°å¯¹åº”çš„key æˆ–è€… keyPathç›¸å…³æ–¹æ³•æˆ–è€…å˜é‡æ—¶ï¼Œä¼šè°ƒç”¨å¯¹åº”çš„å¼‚å¸¸æ–¹æ³•valueForUndefinedKey: æˆ– setValue:forUndefinedKey:ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°æ˜¯æŠ›å‡ºå¼‚å¸¸NSUnKnownKeyExceptionï¼Œå¹¶å¯¼è‡´ç¨‹åºCrashã€‚æˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç†å¼‚å¸¸</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Given that an invocation of -valueForKey: would be unable to get a keyed value using its default access mechanism, return the keyed value using some other mechanism. The default implementation of this method raises an NSUndefinedKeyException. You can override it to handle properties that are dynamically defined at run-time.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)valueForUndefinedKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Given that an invocation of -setValue:forKey: would be unable to set the keyed value using its default mechanism, set the keyed value using some other mechanism. The default implementation of this method raises an NSUndefinedKeyException. You can override it to handle properties that are dynamically defined at run-time.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">nullable</span> <span class="keyword">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“è¿›è¡Œèµ‹å€¼å¦‚setValue:forKey:æ—¶ï¼Œå¦‚æœkeyçš„æ•°æ®ç±»å‹æ˜¯éå¯¹è±¡ç±»å‹ï¼Œåˆ™valueå°±ç¦æ­¢ä¼ nilã€‚å¦åˆ™è°ƒç”¨setNilValueForKey:æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„é»˜è®¤å®ç°æ˜¯æŠ›å‡ºå¼‚å¸¸NSInvalidArgumentExceptionï¼Œå¹¶å¯¼è‡´ç¨‹åºCrashã€‚æˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•æ¥å¤„ç†å¼‚å¸¸ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setNilValueForKey:(<span class="built_in">NSString</span> *)key</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@"hidden"</span>]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> setValue:@(<span class="literal">NO</span>) forKey:@â€hiddenâ€];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">super</span> setNilValueForKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/10/30/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-alloc%E3%80%81retainCount%E3%80%81retain%E3%80%81release%E3%80%81dealloc/" rel="prev" title="å†…å­˜ç®¡ç†-allocã€retainCountã€retainã€releaseã€dealloc">
      <i class="fa fa-chevron-left"></i> å†…å­˜ç®¡ç†-allocã€retainCountã€retainã€releaseã€dealloc
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/08/iOS%E2%80%94%E2%80%94KVO%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/" rel="next" title="iOSâ€”â€”KVOç›¸å…³æ€»ç»“">
      iOSâ€”â€”KVOç›¸å…³æ€»ç»“ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#KVC"><span class="nav-number">1.</span> <span class="nav-text">KVC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¸¸ç”¨API"><span class="nav-number">1.1.</span> <span class="nav-text">å¸¸ç”¨API</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#setValue-forKey"><span class="nav-number">1.1.1.</span> <span class="nav-text">setValue:forKey</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#valueForKey"><span class="nav-number">1.1.2.</span> <span class="nav-text">valueForKey</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#setValue-forKeyPath"><span class="nav-number">1.1.3.</span> <span class="nav-text">setValue:forKeyPath</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤šå€¼æ“ä½œ"><span class="nav-number">1.2.</span> <span class="nav-text">å¤šå€¼æ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è®¿é—®é›†åˆå±æ€§"><span class="nav-number">1.3.</span> <span class="nav-text">è®¿é—®é›†åˆå±æ€§</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨é›†åˆè¿ç®—ç¬¦"><span class="nav-number">1.4.</span> <span class="nav-text">ä½¿ç”¨é›†åˆè¿ç®—ç¬¦</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#èšåˆè¿ç®—ç¬¦"><span class="nav-number">1.4.1.</span> <span class="nav-text">èšåˆè¿ç®—ç¬¦</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#avg"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">@avg</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#count"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">@count</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#sum"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">@sum</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#max"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">@max</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ•°ç»„è¿ç®—ç¬¦"><span class="nav-number">1.4.2.</span> <span class="nav-text">æ•°ç»„è¿ç®—ç¬¦</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#unionOfObjects"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">@unionOfObjects</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#distinctUnionOfObjects"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">@distinctUnionOfObjects</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#åµŒå¥—è¿ç®—ç¬¦"><span class="nav-number">1.4.3.</span> <span class="nav-text">åµŒå¥—è¿ç®—ç¬¦</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#unionOfArrays"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">@unionOfArrays</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#distinctUnionOfArrays"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">@distinctUnionOfArrays</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#distinctUnionOfSets"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">@distinctUnionOfSets</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ‰©å±•"><span class="nav-number">1.4.4.</span> <span class="nav-text">æ‰©å±•</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è‡ªå®šä¹‰é›†åˆè¿ç®—ç¬¦"><span class="nav-number">1.5.</span> <span class="nav-text">è‡ªå®šä¹‰é›†åˆè¿ç®—ç¬¦</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#éå¯¹è±¡å€¼å¤„ç†"><span class="nav-number">1.6.</span> <span class="nav-text">éå¯¹è±¡å€¼å¤„ç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å±æ€§éªŒè¯"><span class="nav-number">1.7.</span> <span class="nav-text">å±æ€§éªŒè¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æœç´¢è§„åˆ™"><span class="nav-number">1.8.</span> <span class="nav-text">æœç´¢è§„åˆ™</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åŸºæœ¬çš„getteræœç´¢æ¨¡å¼"><span class="nav-number">1.8.1.</span> <span class="nav-text">åŸºæœ¬çš„getteræœç´¢æ¨¡å¼</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#åŸºæœ¬çš„Setteræœç´¢æ¨¡å¼"><span class="nav-number">1.8.2.</span> <span class="nav-text">åŸºæœ¬çš„Setteræœç´¢æ¨¡å¼</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å…¶ä»–æœç´¢æ¨¡å¼"><span class="nav-number">1.8.3.</span> <span class="nav-text">å…¶ä»–æœç´¢æ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¼‚å¸¸å¤„ç†"><span class="nav-number">1.9.</span> <span class="nav-text">å¼‚å¸¸å¤„ç†</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Doris AI</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Doris AI</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme â€“ <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
